!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.UMAP=e():t.UMAP=e()}(this,()=>(()=>{"use strict";var __webpack_modules__={24(t,e,r){var o,s=this&&this.__createBinding||(Object.create?function(t,e,r,o){void 0===o&&(o=r);var s=Object.getOwnPropertyDescriptor(e,r);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,o,s)}:function(t,e,r,o){void 0===o&&(o=r),t[o]=e[r]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||(o=function(t){return o=Object.getOwnPropertyNames||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[e.length]=r);return e},o(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r=o(t),i=0;i<r.length;i++)"default"!==r[i]&&s(e,t,r[i]);return n(e,t),e});Object.defineProperty(e,"__esModule",{value:!0}),e.makeHeap=u,e.rejectionSample=function(t,e,r){for(var o=a.zeros(t),s=0;s<t;s++){for(var n=!0,i=0;n;){i=a.tauRandInt(e,r);for(var u=!1,h=0;h<s;h++)if(i===o[h]){u=!0;break}u||(n=!1)}o[s]=i}return o},e.heapPush=h,e.uncheckedHeapPush=l,e.buildCandidates=function(t,e,r,o,s){for(var n=u(e,o),i=0;i<e;i++)for(var l=0;l<r;l++)if(!(t[0][i][l]<0)){var c=t[0][i][l],f=t[2][i][l],m=a.tauRand(s);h(n,i,m,c,f),h(n,c,m,i,f),t[2][i][l]=0}return n},e.deheapSort=function(t){for(var e=t[0],r=t[1],o=0;o<e.length;o++)for(var s=e[o],n=r[o],i=0;i<s.length-1;i++){var a=s.length-i-1,u=n.length-i-1,h=s[0];s[0]=s[a],s[a]=h;var l=n[0];n[0]=n[u],n[u]=l,c(n,s,u,0)}return{indices:e,weights:r}},e.smallestFlagged=function(t,e){for(var r=t[0][e],o=t[1][e],s=t[2][e],n=1/0,i=-1,a=0;a>r.length;a++)1===s[a]&&o[a]<n&&(n=o[a],i=a);return i>=0?(s[i]=0,Math.floor(r[i])):-1};var a=i(r(185));function u(t,e){var r=function(r){return a.empty(t).map(function(){return a.filled(e,r)})},o=[];return o.push(r(-1)),o.push(r(1/0)),o.push(r(0)),o}function h(t,e,r,o,s){e=Math.floor(e);var n=t[0][e],i=t[1][e];if(t[2][e],r>=i[0])return 0;for(var a=0;a<n.length;a++)if(o===n[a])return 0;return l(t,e,r,o,s)}function l(t,e,r,o,s){var n=t[0][e],i=t[1][e],a=t[2][e];if(r>=i[0])return 0;i[0]=r,n[0]=o,a[0]=s;for(var u=0,h=0;;){var l=2*u+1,c=l+1,f=t[0][0].length;if(l>=f)break;if(c>=f){if(!(i[l]>r))break;h=l}else if(i[l]>=i[c]){if(!(r<i[l]))break;h=l}else{if(!(r<i[c]))break;h=c}i[u]=i[h],n[u]=n[h],a[u]=a[h],u=h}return i[u]=r,n[u]=o,a[u]=s,1}function c(t,e,r,o){for(;2*o+1<r;){var s=2*o+1,n=s+1,i=o;if(t[i]<t[s]&&(i=s),n<r&&t[i]<t[n]&&(i=n),i===o)break;var a=t[o];t[o]=t[i],t[i]=a;var u=e[o];e[o]=e[i],e[i]=u,o=i}}},47(t,e,r){var o,s=this&&this.__createBinding||(Object.create?function(t,e,r,o){void 0===o&&(o=r);var s=Object.getOwnPropertyDescriptor(e,r);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,o,s)}:function(t,e,r,o){void 0===o&&(o=r),t[o]=e[r]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||(o=function(t){return o=Object.getOwnPropertyNames||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[e.length]=r);return e},o(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r=o(t),i=0;i<r.length;i++)"default"!==r[i]&&s(e,t,r[i]);return n(e,t),e}),a=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.makeNNDescent=function(t,e){return function(r,o,s,n,i,a,h,l){void 0===n&&(n=10),void 0===i&&(i=50),void 0===a&&(a=.001),void 0===h&&(h=.5),void 0===l&&(l=!0);for(var f=r.length,m=u.makeHeap(r.length,s),p=0;p<r.length;p++)for(var g=u.rejectionSample(s,r.length,e),w=0;w<g.length;w++){var d=t(r[p],r[g[w]]);u.heapPush(m,p,d,g[w],1),u.heapPush(m,g[w],d,p,1)}if(l)for(var y=0;y<o.length;y++)for(p=0;p<o[y].length&&!(o[y][p]<0);p++)for(w=p+1;w<o[y].length&&!(o[y][w]<0);w++)d=t(r[o[y][p]],r[o[y][w]]),u.heapPush(m,o[y][p],d,o[y][w],1),u.heapPush(m,o[y][w],d,o[y][p],1);for(y=0;y<n;y++){var b=u.buildCandidates(m,f,s,i,e),v=0;for(p=0;p<f;p++)for(w=0;w<i;w++){var M=Math.floor(b[0][p][w]);if(!(M<0||c.tauRand(e)<h))for(var x=0;x<i;x++){var S=Math.floor(b[0][p][x]),_=b[2][p][w],E=b[2][p][x];S<0||!_&&!E||(d=t(r[M],r[S]),v+=u.heapPush(m,M,d,S,1),v+=u.heapPush(m,S,d,M,1))}}if(v<=a*s*r.length)break}return u.deheapSort(m)}},e.makeInitializations=function(t){return{initFromRandom:function(e,r,o,s,n){for(var i=0;i<o.length;i++)for(var a=c.rejectionSample(e,r.length,n),h=0;h<a.length;h++)if(!(a[h]<0)){var l=t(r[a[h]],o[i]);u.heapPush(s,i,l,a[h],1)}},initFromTree:function(e,r,o,s,n){for(var i=0;i<o.length;i++)for(var a=l.searchFlatTree(o[i],e,n),h=0;h<a.length;h++){if(a[h]<0)return;var c=t(r[a[h]],o[i]);u.heapPush(s,i,c,a[h],1)}}}},e.makeInitializedNNSearch=function(t){return function(e,r,o,s){for(var n,i,l=h.getCSR(r),c=l.indices,f=l.indptr,m=0;m<s.length;m++)for(var p=new Set(o[0][m]);;){var g=u.smallestFlagged(o,m);if(-1===g)break;var w=c.slice(f[g],f[g+1]);try{for(var d=(n=void 0,a(w)),y=d.next();!y.done;y=d.next()){var b=y.value;if(b!==g&&-1!==b&&!p.has(b)){var v=t(e[b],s[m]);u.uncheckedHeapPush(o,m,v,b,1),p.add(b)}}}catch(t){n={error:t}}finally{try{y&&!y.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}}return o}},e.initializeSearch=function(t,e,r,o,s,n,i){var h,l,c=u.makeHeap(r.length,o);if(s(o,e,r,c,i),t)try{for(var f=a(t),m=f.next();!m.done;m=f.next())n(m.value,e,r,c,i)}catch(t){h={error:t}}finally{try{m&&!m.done&&(l=f.return)&&l.call(f)}finally{if(h)throw h.error}}return c};var u=i(r(24)),h=i(r(499)),l=i(r(450)),c=i(r(185))},103(__unused_webpack_module,exports){var __webpack_dirname__="/",__awaiter=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))(function(s,n){function i(t){try{u(o.next(t))}catch(t){n(t)}}function a(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(i,a)}u((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var r,o,s,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(n=0)),n;)try{if(r=1,o&&(s=2&a[0]?o.return:a[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,a[1])).done)return s;switch(o=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,o=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(!((s=(s=n.trys).length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){n=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){n.label=a[1];break}if(6===a[0]&&n.label<s[1]){n.label=s[1],s=a;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(a);break}s[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(t){a=[6,t],o=0}finally{r=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},__values=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.initWasm=initWasm,exports.isWasmAvailable=isWasmAvailable,exports.euclideanWasm=euclideanWasm,exports.cosineWasm=cosineWasm,exports.buildRpTreeWasm=buildRpTreeWasm,exports.searchFlatTreeWasm=searchFlatTreeWasm,exports.wasmTreeToJs=wasmTreeToJs,exports.createSparseMatrixWasm=createSparseMatrixWasm,exports.sparseTransposeWasm=sparseTransposeWasm,exports.sparseIdentityWasm=sparseIdentityWasm,exports.sparseAddWasm=sparseAddWasm,exports.sparseSubtractWasm=sparseSubtractWasm,exports.sparsePairwiseMultiplyWasm=sparsePairwiseMultiplyWasm,exports.sparseMaximumWasm=sparseMaximumWasm,exports.sparseMultiplyScalarWasm=sparseMultiplyScalarWasm,exports.sparseEliminateZerosWasm=sparseEliminateZerosWasm,exports.sparseNormalizeWasm=sparseNormalizeWasm,exports.sparseGetCSRWasm=sparseGetCSRWasm,exports.wasmSparseMatrixToArray=wasmSparseMatrixToArray,exports.wasmSparseMatrixGetAll=wasmSparseMatrixGetAll;var wasmReady=null,wasmModule=null;function initWasm(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return wasmReady||(wasmReady=function(){return __awaiter(_this,void 0,void 0,function(){var mod,lastError,maybeRequire,pathModule,fsModule,candidates,candidates_1,candidates_1_1,candidate,e_1,_a;return __generator(this,function(_b){try{mod=void 0,lastError=null;try{if(maybeRequire=eval("typeof __non_webpack_require__ !== 'undefined' ? __non_webpack_require__ : (typeof require !== 'undefined' ? require : undefined)"),maybeRequire)try{pathModule=maybeRequire("path"),fsModule=maybeRequire("fs"),candidates=[pathModule.resolve(process.cwd(),"wasm/pkg/umap_wasm_core.js"),pathModule.resolve(__webpack_dirname__,"../wasm/pkg/umap_wasm_core.js"),pathModule.resolve(__webpack_dirname__,"../../wasm/pkg/umap_wasm_core.js"),pathModule.resolve(__webpack_dirname__,"../../../wasm/pkg/umap_wasm_core.js")];try{for(candidates_1=__values(candidates),candidates_1_1=candidates_1.next();!candidates_1_1.done;candidates_1_1=candidates_1.next()){candidate=candidates_1_1.value;try{if(fsModule.existsSync(candidate))return mod=maybeRequire(candidate),wasmModule=mod,[2,mod]}catch(t){}}}catch(t){e_1={error:t}}finally{try{candidates_1_1&&!candidates_1_1.done&&(_a=candidates_1.return)&&_a.call(candidates_1)}finally{if(e_1)throw e_1.error}}}catch(t){lastError=t}}catch(t){lastError=t}throw new Error("Could not load WASM module via CommonJS require")}catch(t){throw wasmReady=null,wasmModule=null,new Error("Failed to load WASM module: ".concat(t))}})})}()),[2,wasmReady]})})}function isWasmAvailable(){return null!==wasmModule}function euclideanWasm(t,e){if(!wasmModule)throw new Error("WASM module not initialized");var r=new Float64Array(t),o=new Float64Array(e);return wasmModule.euclidean(r,o)}function cosineWasm(t,e){if(!wasmModule)throw new Error("WASM module not initialized");var r=new Float64Array(t),o=new Float64Array(e);return wasmModule.cosine(r,o)}function buildRpTreeWasm(t,e,r,o,s){if(!wasmModule)throw new Error("WASM module not initialized");for(var n=new Float64Array(e*r),i=0;i<e;i++)for(var a=0;a<r;a++)n[i*r+a]=t[i][a];return wasmModule.build_rp_tree(n,e,r,o,BigInt(s))}function searchFlatTreeWasm(t,e,r){if(!wasmModule)throw new Error("WASM module not initialized");var o=new Float64Array(e),s=wasmModule.search_flat_tree(t,o,BigInt(r));return Array.from(s)}function wasmTreeToJs(t){for(var e=Array.from(t.hyperplanes()),r=Array.from(t.offsets()),o=Array.from(t.children()),s=Array.from(t.indices()),n=t.dim(),i=t.n_nodes(),a=[],u=0;u<i;u++)a.push(e.slice(u*n,(u+1)*n));var h=[];for(u=0;u<i;u++)h.push([o[2*u],o[2*u+1]]);var l=0;for(u=0;u<o.length;u++){var c=o[u];if(c<=0){var f=-c;f>l&&(l=f)}}var m=l+1,p=m>0?Math.floor(s.length/m):0,g=[];for(u=0;u<m;u++){for(var w=s.slice(u*p,(u+1)*p);w.length<p;)w.push(-1);g.push(w)}return{hyperplanes:a,offsets:r,children:h,indices:g}}function createSparseMatrixWasm(t,e,r,o,s){if(!wasmModule)throw new Error("WASM module not initialized");var n=new Int32Array(t),i=new Int32Array(e),a=new Float64Array(r);return new wasmModule.WasmSparseMatrix(n,i,a,o,s)}function sparseTransposeWasm(t){if(!wasmModule)throw new Error("WASM module not initialized");return wasmModule.sparse_transpose(t)}function sparseIdentityWasm(t){if(!wasmModule)throw new Error("WASM module not initialized");return wasmModule.sparse_identity(t)}function sparseAddWasm(t,e){if(!wasmModule)throw new Error("WASM module not initialized");return wasmModule.sparse_add(t,e)}function sparseSubtractWasm(t,e){if(!wasmModule)throw new Error("WASM module not initialized");return wasmModule.sparse_subtract(t,e)}function sparsePairwiseMultiplyWasm(t,e){if(!wasmModule)throw new Error("WASM module not initialized");return wasmModule.sparse_pairwise_multiply(t,e)}function sparseMaximumWasm(t,e){if(!wasmModule)throw new Error("WASM module not initialized");return wasmModule.sparse_maximum(t,e)}function sparseMultiplyScalarWasm(t,e){if(!wasmModule)throw new Error("WASM module not initialized");return wasmModule.sparse_multiply_scalar(t,e)}function sparseEliminateZerosWasm(t){if(!wasmModule)throw new Error("WASM module not initialized");return wasmModule.sparse_eliminate_zeros(t)}function sparseNormalizeWasm(t,e){if(void 0===e&&(e="l2"),!wasmModule)throw new Error("WASM module not initialized");return wasmModule.sparse_normalize(t,e)}function sparseGetCSRWasm(t){if(!wasmModule)throw new Error("WASM module not initialized");var e=Array.from(wasmModule.sparse_get_csr(t)),r=e[0],o=e[1],s=e[2];return{indices:e.slice(3,3+r),values:e.slice(3+r,3+r+o),indptr:e.slice(3+r+o,3+r+o+s)}}function wasmSparseMatrixToArray(t){for(var e=Array.from(t.to_array()),r=t.n_rows,o=t.n_cols,s=[],n=0;n<r;n++)s.push(e.slice(n*o,(n+1)*o));return s}function wasmSparseMatrixGetAll(t){for(var e=Array.from(t.get_all_ordered()),r=[],o=0;o<e.length;o+=3)r.push({row:e[o],col:e[o+1],value:e[o+2]});return r}},185(t,e){var r=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function o(t,e){return Math.floor(e()*t)}function s(t){for(var e=[],r=0;r<t;r++)e.push(void 0);return e}function n(t,e){return s(t).map(function(){return e})}function i(t){return n(t,0)}function a(t){return t.reduce(function(t,e){return t+e})}Object.defineProperty(e,"__esModule",{value:!0}),e.tauRandInt=o,e.tauRand=function(t){return t()},e.norm=function(t){var e,o,s=0;try{for(var n=r(t),i=n.next();!i.done;i=n.next()){var a=i.value;s+=Math.pow(a,2)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(e)throw e.error}}return Math.sqrt(s)},e.empty=s,e.range=function(t){return s(t).map(function(t,e){return e})},e.filled=n,e.zeros=i,e.ones=function(t){return n(t,1)},e.linear=function(t,e,r){return s(r).map(function(o,s){return t+s*((e-t)/(r-1))})},e.sum=a,e.mean=function(t){return a(t)/t.length},e.max=function(t){for(var e=0,r=0;r<t.length;r++)e=t[r]>e?t[r]:e;return e},e.max2d=function(t){for(var e=0,r=0;r<t.length;r++)for(var o=0;o<t[r].length;o++)e=t[r][o]>e?t[r][o]:e;return e},e.rejectionSample=function(t,e,r){for(var s=i(t),n=0;n<t;n++)for(var a=!0;a;){for(var u=o(e,r),h=!1,l=0;l<n;l++)if(u===s[l]){h=!0;break}h||(a=!1),s[n]=u}return s},e.reshape2d=function(t,e,r){var o=[],s=0;if(t.length!==e*r)throw new Error("Array dimensions must match input length.");for(var n=0;n<e;n++){for(var i=[],a=0;a<r;a++)i.push(t[s]),s+=1;o.push(i)}return o}},329(t,e,r){var o,s=this&&this.__createBinding||(Object.create?function(t,e,r,o){void 0===o&&(o=r);var s=Object.getOwnPropertyDescriptor(e,r);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,o,s)}:function(t,e,r,o){void 0===o&&(o=r),t[o]=e[r]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||(o=function(t){return o=Object.getOwnPropertyNames||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[e.length]=r);return e},o(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r=o(t),i=0;i<r.length;i++)"default"!==r[i]&&s(e,t,r[i]);return n(e,t),e}),a=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))(function(s,n){function i(t){try{u(o.next(t))}catch(t){n(t)}}function a(t){try{u(o.throw(t))}catch(t){n(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(i,a)}u((o=o.apply(t,e||[])).next())})},u=this&&this.__generator||function(t,e){var r,o,s,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(n=0)),n;)try{if(r=1,o&&(s=2&a[0]?o.return:a[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,a[1])).done)return s;switch(o=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return n.label++,{value:a[1],done:!1};case 5:n.label++,o=a[1],a=[0];continue;case 7:a=n.ops.pop(),n.trys.pop();continue;default:if(!((s=(s=n.trys).length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){n=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){n.label=a[1];break}if(6===a[0]&&n.label<s[1]){n.label=s[1],s=a;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(a);break}s[2]&&n.ops.pop(),n.trys.pop();continue}a=e.call(t,n)}catch(t){a=[6,t],o=0}finally{r=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},h=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,s,n=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(t){s={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i},l=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var o,s=0,n=e.length;s<n;s++)!o&&s in e||(o||(o=Array.prototype.slice.call(e,0,s)),o[s]=e[s]);return t.concat(o||Array.prototype.slice.call(e))},c=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.UMAP=void 0,e.euclidean=x,e.cosine=function(t,e){for(var r=0,o=0,s=0,n=0;n<t.length;n++)r+=t[n]*e[n],o+=Math.pow(t[n],2),s+=Math.pow(e[n],2);return 0===o&&0===s?0:0===o||0===s?1:1-r/Math.sqrt(o*s)},e.findABParams=A,e.fastIntersection=R,e.resetLocalConnectivity=k,e.initTransform=N;var f=i(r(24)),m=i(r(499)),p=i(r(47)),g=i(r(450)),w=i(r(185)),d=c(r(527)),y=i(r(103)),b=1e-5,v=.001,M=function(){function t(t){void 0===t&&(t={});var e=this;this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=x,this.useWasmDistance=!1,this.useWasmMatrix=!1,this.useWasmTree=!1,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new S;var r=function(r){void 0!==t[r]&&(e[r]=t[r])};r("distanceFn"),r("useWasmDistance"),r("useWasmMatrix"),r("useWasmTree"),r("learningRate"),r("localConnectivity"),r("minDist"),r("nComponents"),r("nEpochs"),r("nNeighbors"),r("negativeSampleRate"),r("random"),r("repulsionStrength"),r("setOpMixRatio"),r("spread"),r("transformQueueSize")}return t.prototype.fit=function(t){return this.initializeFit(t),this.optimizeLayout(),this.embedding},t.prototype.fitAsync=function(t){return a(this,arguments,void 0,function(t,e){return void 0===e&&(e=function(){return!0}),u(this,function(r){switch(r.label){case 0:return this.initializeFit(t),[4,this.optimizeLayoutAsync(e)];case 1:return r.sent(),[2,this.embedding]}})})},t.prototype.setSupervisedProjection=function(t,e){void 0===e&&(e={}),this.Y=t,this.targetMetric=e.targetMetric||this.targetMetric,this.targetWeight=e.targetWeight||this.targetWeight,this.targetNNeighbors=e.targetNNeighbors||this.targetNNeighbors},t.prototype.setPrecomputedKNN=function(t,e){this.knnIndices=t,this.knnDistances=e},t.prototype.initializeFit=function(t){if(t.length<=this.nNeighbors)throw new Error("Not enough data points (".concat(t.length,") to create nNeighbors: ").concat(this.nNeighbors,".  Add more data points or adjust the configuration."));if(this.X===t&&this.isInitialized)return this.getNEpochs();if(this.X=t,!this.knnIndices&&!this.knnDistances){var e=this.nearestNeighbors(t);this.knnIndices=e.knnIndices,this.knnDistances=e.knnDistances}this.graph=this.fuzzySimplicialSet(t,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(t),this.processGraphForSupervisedProjection();var r=this.initializeSimplicialSetEmbedding(),o=r.head,s=r.tail,n=r.epochsPerSample;return this.optimizationState.head=o,this.optimizationState.tail=s,this.optimizationState.epochsPerSample=n,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},t.prototype.makeSearchFns=function(){var t=this,e=function(e,r){if(t.useWasmDistance){if(!y.isWasmAvailable())throw new Error("WASM distance requested via `useWasmDistance: true` but the wasm module is not initialized or available. Call `await wasmBridge.initWasm()` before using UMAP with wasm distances or build the wasm package.");return y.euclideanWasm(e,r)}return t.distanceFn(e,r)},r=p.makeInitializations(e),o=r.initFromTree,s=r.initFromRandom;this.initFromTree=o,this.initFromRandom=s,this.search=p.makeInitializedNNSearch(e)},t.prototype.computeDistance=function(t,e){if(this.useWasmDistance){if(!y.isWasmAvailable())throw new Error("WASM distance requested via `useWasmDistance: true` but the wasm module is not initialized or available. Call `await wasmBridge.initWasm()` before using UMAP with wasm distances or build the wasm package.");return y.euclideanWasm(t,e)}return this.distanceFn(t,e)},t.prototype.makeSearchGraph=function(t){for(var e=this.knnIndices,r=this.knnDistances,o=[t.length,t.length],s=new m.SparseMatrix([],[],[],o),n=0;n<e.length;n++)for(var i=e[n],a=r[n],u=0;u<i.length;u++){var h=i[u],l=a[u];l>0&&s.set(n,h,l)}var c=m.transpose(s);return m.maximum(s,c)},t.prototype.transform=function(t){var e=this,r=this.X;if(void 0===r||0===r.length)throw new Error("No data has been fit.");var o=Math.floor(this.nNeighbors*this.transformQueueSize);o=Math.min(r.length,o);var s=p.initializeSearch(this.rpForest,r,t,o,this.initFromRandom,this.initFromTree,this.random),n=this.search(r,this.searchGraph,s,t),i=f.deheapSort(n),a=i.indices,u=i.weights;a=a.map(function(t){return t.slice(0,e.nNeighbors)}),u=u.map(function(t){return t.slice(0,e.nNeighbors)});var h=Math.max(0,this.localConnectivity-1),l=this.smoothKNNDistance(u,this.nNeighbors,h),c=l.sigmas,g=l.rhos,d=this.computeMembershipStrengths(a,u,c,g),y=d.rows,b=d.cols,v=d.vals,M=[t.length,r.length],x=new m.SparseMatrix(y,b,v,M),S=m.normalize(x,"l1"),_=m.getCSR(S),E=t.length,A=N(w.reshape2d(_.indices,E,this.nNeighbors),w.reshape2d(_.values,E,this.nNeighbors),this.embedding),R=this.nEpochs?this.nEpochs/3:x.nRows<=1e4?100:30,k=x.getValues().reduce(function(t,e){return e>t?e:t},0);x=x.map(function(t){return t<k/R?0:t}),x=m.eliminateZeros(x);var z=this.makeEpochsPerSample(x.getValues(),R),T=x.getRows(),W=x.getCols();return this.assignOptimizationStateParameters({headEmbedding:A,tailEmbedding:this.embedding,head:T,tail:W,currentEpoch:0,nEpochs:R,nVertices:x.getDims()[1],epochsPerSample:z}),this.prepareForOptimizationLoop(),this.optimizeLayout()},t.prototype.processGraphForSupervisedProjection=function(){var t=this.Y,e=this.X;if(t){if(t.length!==e.length)throw new Error("Length of X and y must be equal");if("categorical"===this.targetMetric){var r=this.targetWeight<1?1/(1-this.targetWeight)*2.5:1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,t,r)}}},t.prototype.step=function(){var t=this.optimizationState.currentEpoch;return t<this.getNEpochs()&&this.optimizeLayoutStep(t),this.optimizationState.currentEpoch},t.prototype.getEmbedding=function(){return this.embedding},t.prototype.nearestNeighbors=function(t){var e,r=this.distanceFn,o=this.nNeighbors,s=p.makeNNDescent(r,this.random),n=5+Math.floor(.5==(e=Math.pow(t.length,.5)/20)?0:Math.round(e)),i=Math.max(5,Math.floor(Math.round(function(t){return Math.log(t)/Math.log(2)}(t.length))));this.rpForest=g.makeForest(t,o,n,this.random,this.useWasmTree);var a=s(t,g.makeLeafArray(this.rpForest),o,i);return{knnIndices:a.indices,knnDistances:a.weights}},t.prototype.fuzzySimplicialSet=function(t,e,r){void 0===r&&(r=1);var o=this,s=o.knnIndices,n=void 0===s?[]:s,i=o.knnDistances,a=void 0===i?[]:i,u=o.localConnectivity,h=this.smoothKNNDistance(a,e,u),l=h.sigmas,c=h.rhos,f=this.computeMembershipStrengths(n,a,l,c),p=f.rows,g=f.cols,w=f.vals,d=[t.length,t.length];if(this.useWasmMatrix&&y.isWasmAvailable()){var b=y.createSparseMatrixWasm(p,g,w,d[0],d[1]),v=y.sparseTransposeWasm(b),M=y.sparsePairwiseMultiplyWasm(b,v),x=y.sparseAddWasm(b,v),S=y.sparseSubtractWasm(x,M),_=y.sparseMultiplyScalarWasm(S,r),E=y.sparseMultiplyScalarWasm(M,1-r),A=y.sparseAddWasm(_,E),R=(z=y.wasmSparseMatrixGetAll(A)).map(function(t){return t.row}),k=z.map(function(t){return t.col}),N=z.map(function(t){return t.value});return new m.SparseMatrix(R,k,N,d)}if(this.useWasmMatrix&&y.isWasmAvailable()){b=y.createSparseMatrixWasm(p,g,w,d[0],d[1]);var z,T=y.sparseTransposeWasm(b),W=y.sparsePairwiseMultiplyWasm(b,T),I=(x=y.sparseAddWasm(b,T),y.sparseSubtractWasm(x,W)),P=y.sparseMultiplyScalarWasm(I,r),O=y.sparseMultiplyScalarWasm(W,1-r);return A=y.sparseAddWasm(P,O),R=(z=y.wasmSparseMatrixGetAll(A)).map(function(t){return t.row}),k=z.map(function(t){return t.col}),N=z.map(function(t){return t.value}),new m.SparseMatrix(R,k,N,d)}var j=new m.SparseMatrix(p,g,w,d),C=m.transpose(j),q=m.pairwiseMultiply(j,C),F=m.subtract(m.add(j,C),q),D=m.multiplyScalar(F,r),V=m.multiplyScalar(q,1-r);return m.add(D,V)},t.prototype.categoricalSimplicialSetIntersection=function(t,e,r,o){void 0===o&&(o=1);var s=R(t,e,o,r);return k(s=m.eliminateZeros(s))},t.prototype.smoothKNNDistance=function(t,e,r,o,s){void 0===r&&(r=1),void 0===o&&(o=64),void 0===s&&(s=1);for(var n=Math.log(e)/Math.log(2)*s,i=w.zeros(t.length),a=w.zeros(t.length),u=0;u<t.length;u++){var h=0,l=1/0,c=1,f=t[u],m=f.filter(function(t){return t>0});if(m.length>=r){var p=Math.floor(r),g=r-p;p>0?(i[u]=m[p-1],g>b&&(i[u]+=g*(m[p]-m[p-1]))):i[u]=g*m[0]}else m.length>0&&(i[u]=w.max(m));for(var d=0;d<o;d++){for(var y=0,M=1;M<t[u].length;M++){var x=t[u][M]-i[u];y+=x>0?Math.exp(-x/c):1}if(Math.abs(y-n)<b)break;y>n?c=(h+(l=c))/2:(h=c,l===1/0?c*=2:c=(h+l)/2)}if(a[u]=c,i[u]>0){var S=w.mean(f);a[u]<v*S&&(a[u]=v*S)}else{var _=w.mean(t.map(w.mean));a[u]<v*_&&(a[u]=v*_)}}return{sigmas:a,rhos:i}},t.prototype.computeMembershipStrengths=function(t,e,r,o){for(var s=t.length,n=t[0].length,i=w.zeros(s*n),a=w.zeros(s*n),u=w.zeros(s*n),h=0;h<s;h++)for(var l=0;l<n;l++){var c=0;-1!==t[h][l]&&(c=t[h][l]===h?0:e[h][l]-o[h]<=0?1:Math.exp(-(e[h][l]-o[h])/r[h]),i[h*n+l]=h,a[h*n+l]=t[h][l],u[h*n+l]=c)}return{rows:i,cols:a,vals:u}},t.prototype.initializeSimplicialSetEmbedding=function(){for(var t=this,e=this.getNEpochs(),r=this.nComponents,o=this.graph.getValues(),s=0,n=0;n<o.length;n++){var i=o[n];s<o[n]&&(s=i)}var a=this.graph.map(function(t){return t<s/e?0:t});this.embedding=w.zeros(a.nRows).map(function(){return w.zeros(r).map(function(){return 20*w.tauRand(t.random)-10})});var u=[],h=[],l=[],c=a.getAll();for(n=0;n<c.length;n++){var f=c[n];f.value&&(u.push(f.value),l.push(f.row),h.push(f.col))}return{head:h,tail:l,epochsPerSample:this.makeEpochsPerSample(u,e)}},t.prototype.makeEpochsPerSample=function(t,e){var r=w.filled(t.length,-1),o=w.max(t),s=t.map(function(t){return t/o*e});return s.forEach(function(t,o){t>0&&(r[o]=e/s[o])}),r},t.prototype.assignOptimizationStateParameters=function(t){Object.assign(this.optimizationState,t)},t.prototype.prepareForOptimizationLoop=function(){var t=this,e=t.repulsionStrength,r=t.learningRate,o=t.negativeSampleRate,s=this.optimizationState,n=s.epochsPerSample,i=s.headEmbedding,a=s.tailEmbedding,u=i[0].length,c=i.length===a.length,f=n.map(function(t){return t/o}),m=l([],h(f),!1),p=l([],h(n),!1);this.assignOptimizationStateParameters({epochOfNextSample:p,epochOfNextNegativeSample:m,epochsPerNegativeSample:f,moveOther:c,initialAlpha:r,alpha:r,gamma:e,dim:u})},t.prototype.initializeOptimization=function(){var t=this.embedding,e=this.embedding,r=this.optimizationState,o=r.head,s=r.tail,n=r.epochsPerSample,i=this.getNEpochs(),a=this.graph.nCols,u=A(this.spread,this.minDist),h=u.a,l=u.b;this.assignOptimizationStateParameters({headEmbedding:t,tailEmbedding:e,head:o,tail:s,epochsPerSample:n,a:h,b:l,nEpochs:i,nVertices:a})},t.prototype.optimizeLayoutStep=function(t){for(var e=this.optimizationState,r=e.head,o=e.tail,s=e.headEmbedding,n=e.tailEmbedding,i=e.epochsPerSample,a=e.epochOfNextSample,u=e.epochOfNextNegativeSample,h=e.epochsPerNegativeSample,l=e.moveOther,c=e.initialAlpha,f=e.alpha,m=e.gamma,p=e.a,g=e.b,d=e.dim,y=e.nEpochs,b=e.nVertices,v=0;v<i.length;v++)if(!(a[v]>t)){var M=r[v],x=o[v],S=s[M],A=n[x],R=E(S,A),k=0;R>0&&(k=-2*p*g*Math.pow(R,g-1),k/=p*Math.pow(R,g)+1);for(var N=0;N<d;N++){var z=_(k*(S[N]-A[N]),4);S[N]+=z*f,l&&(A[N]+=-z*f)}a[v]+=i[v];for(var T=Math.floor((t-u[v])/h[v]),W=0;W<T;W++){var I=w.tauRandInt(b,this.random),P=n[I],O=E(S,P),j=0;if(O>0)j=2*m*g,j/=(.001+O)*(p*Math.pow(O,g)+1);else if(M===I)continue;for(N=0;N<d;N++)z=4,j>0&&(z=_(j*(S[N]-P[N]),4)),S[N]+=z*f}u[v]+=T*h[v]}return e.alpha=c*(1-t/y),e.currentEpoch+=1,s},t.prototype.optimizeLayoutAsync=function(t){var e=this;return void 0===t&&(t=function(){return!0}),new Promise(function(r,o){var s=function(){return a(e,void 0,void 0,function(){var e,n,i,a,h,l;return u(this,function(u){try{if(e=this.optimizationState,n=e.nEpochs,i=e.currentEpoch,this.embedding=this.optimizeLayoutStep(i),a=this.optimizationState.currentEpoch,h=!1===t(a),l=a===n,h||l)return[2,r(l)];setTimeout(function(){return s()},0)}catch(t){o(t)}return[2]})})};setTimeout(function(){return s()},0)})},t.prototype.optimizeLayout=function(t){void 0===t&&(t=function(){return!0});for(var e=!1,r=[];!e;){var o=this.optimizationState,s=o.nEpochs,n=o.currentEpoch;r=this.optimizeLayoutStep(n);var i=this.optimizationState.currentEpoch,a=!1===t(i);e=i===s||a}return r},t.prototype.getNEpochs=function(){var t=this.graph;if(this.nEpochs>0)return this.nEpochs;var e=t.nRows;return e<=2500?500:e<=5e3?400:e<=7500?300:200},t}();function x(t,e){for(var r=0,o=0;o<t.length;o++)r+=Math.pow(t[o]-e[o],2);return Math.sqrt(r)}e.UMAP=M;var S=function(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0};function _(t,e){return t>e?e:t<-e?-e:t}function E(t,e){for(var r=0,o=0;o<t.length;o++)r+=Math.pow(t[o]-e[o],2);return r}function A(t,e){var r=w.linear(0,3*t,300).map(function(t){return t<e?1:t}),o=w.zeros(r.length).map(function(o,s){return r[s]>=e?Math.exp(-(r[s]-e)/t):o}),s={x:r,y:o},n=(0,d.default)(s,function(t){var e=h(t,2),r=e[0],o=e[1];return function(t){return 1/(1+r*Math.pow(t,2*o))}},{damping:1.5,initialValues:[.5,.5],gradientDifference:.1,maxIterations:100,errorTolerance:.01}).parameterValues,i=h(n,2);return{a:i[0],b:i[1]}}function R(t,e,r,o){return void 0===r&&(r=1),void 0===o&&(o=5),t.map(function(t,s,n){return-1===e[s]||-1===e[n]?t*Math.exp(-r):e[s]!==e[n]?t*Math.exp(-o):t})}function k(t){t=m.normalize(t,"max");var e=m.transpose(t),r=m.pairwiseMultiply(e,t);return t=m.add(t,m.subtract(e,r)),m.eliminateZeros(t)}function N(t,e,r){for(var o=w.zeros(t.length).map(function(t){return w.zeros(r[0].length)}),s=0;s<t.length;s++)for(var n=0;n<t[0].length;n++)for(var i=0;i<r[0].length;i++){var a=t[s][n];o[s][i]+=e[s][n]*r[a][i]}return o}},450(t,e,r){var o,s=this&&this.__createBinding||(Object.create?function(t,e,r,o){void 0===o&&(o=r);var s=Object.getOwnPropertyDescriptor(e,r);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,o,s)}:function(t,e,r,o){void 0===o&&(o=r),t[o]=e[r]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||(o=function(t){return o=Object.getOwnPropertyNames||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[e.length]=r);return e},o(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r=o(t),i=0;i<r.length;i++)"default"!==r[i]&&s(e,t,r[i]);return n(e,t),e}),a=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,s,n=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(t){s={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i},u=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var o,s=0,n=e.length;s<n;s++)!o&&s in e||(o||(o=Array.prototype.slice.call(e,0,s)),o[s]=e[s]);return t.concat(o||Array.prototype.slice.call(e))},h=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.FlatTree=void 0,e.makeForest=function(t,e,r,o,s){void 0===s&&(s=!1);var n=Math.max(10,e);if(s){if(!(0,c.isWasmAvailable)())throw new Error("WASM requested but not available");return function(t,e,r,o){for(var s=t.length,n=t[0].length,i=[],a=0;a<r;a++){var u=Math.floor(4294967295*o()),h=(0,c.buildRpTreeWasm)(t,s,n,e,u);i.push(f.fromWasm(h))}return i}(t,n,r,o)}return l.range(r).map(function(e,r){return function(t,e,r,o){return void 0===e&&(e=30),m(t,l.range(t.length),e,r,o)}(t,n,r,o)}).map(function(t){return function(t,e){var r=g(t),o=w(t),s=l.range(r).map(function(){return l.zeros(t.hyperplane?t.hyperplane.length:0)}),n=l.zeros(r),i=l.range(r).map(function(){return[-1,-1]}),a=l.range(o).map(function(){return l.range(e).map(function(){return-1})});return p(t,s,n,i,a,0,0),new f(s,n,i,a)}(t,n)})},e.makeLeafArray=function(t){var e,r;if(t.length>0){var o=[];try{for(var s=h(t),n=s.next();!n.done;n=s.next()){var i=n.value;o.push.apply(o,u([],a(i.indices),!1))}}catch(t){e={error:t}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return o}return[[-1]]},e.searchFlatTree=function(t,e,r){var o=e.getWasmTree();if(o&&(0,c.isWasmAvailable)()){var s=Math.floor(4294967295*r());return(0,c.searchFlatTreeWasm)(o,t,s)}for(var n=0;e.children[n][0]>0;)n=0===d(e.hyperplanes[n],e.offsets[n],t,r)?e.children[n][0]:e.children[n][1];var i=-1*e.children[n][0];return e.indices[i]};var l=i(r(185)),c=r(103),f=function(){function t(t,e,r,o){this.hyperplanes=t,this.offsets=e,this.children=r,this.indices=o}return t.fromWasm=function(e){var r=(0,c.wasmTreeToJs)(e),o=new t(r.hyperplanes,r.offsets,r.children,r.indices);return o.wasmTree=e,o},t.prototype.getWasmTree=function(){return this.wasmTree},t.prototype.dispose=function(){this.wasmTree&&(this.wasmTree.free(),this.wasmTree=void 0)},t}();function m(t,e,r,o,s){if(void 0===r&&(r=30),e.length>r){var n=function(t,e,r){var o=t[0].length,s=l.tauRandInt(e.length,r),n=l.tauRandInt(e.length,r);n=(n+=s===n?1:0)%e.length;for(var i=e[s],a=e[n],u=0,h=l.zeros(o),c=0;c<h.length;c++)h[c]=t[i][c]-t[a][c],u-=h[c]*(t[i][c]+t[a][c])/2;var f=0,m=0,p=l.zeros(e.length);for(c=0;c<e.length;c++){for(var g=u,w=0;w<o;w++)g+=h[w]*t[e[c]][w];0===g?(p[c]=l.tauRandInt(2,r),0===p[c]?f+=1:m+=1):g>0?(p[c]=0,f+=1):(p[c]=1,m+=1)}var d=l.zeros(f),y=l.zeros(m);for(f=0,m=0,c=0;c<p.length;c++)0===p[c]?(d[f]=e[c],f+=1):(y[m]=e[c],m+=1);return{indicesLeft:d,indicesRight:y,hyperplane:h,offset:u}}(t,e,s),i=n.indicesLeft,a=n.indicesRight,u=n.hyperplane,h=n.offset;return{leftChild:m(t,i,r,o+1,s),rightChild:m(t,a,r,o+1,s),isLeaf:!1,hyperplane:u,offset:h}}return{indices:e,isLeaf:!0}}function p(t,e,r,o,s,n,i){var h;if(t.isLeaf)return o[n][0]=-i,(h=s[i]).splice.apply(h,u([0,t.indices.length],a(t.indices),!1)),{nodeNum:n,leafNum:i+=1};e[n]=t.hyperplane,r[n]=t.offset,o[n][0]=n+1;var l=n,c=p(t.leftChild,e,r,o,s,n+1,i);return n=c.nodeNum,i=c.leafNum,o[l][1]=n+1,{nodeNum:(c=p(t.rightChild,e,r,o,s,n+1,i)).nodeNum,leafNum:c.leafNum}}function g(t){return t.isLeaf?1:1+g(t.leftChild)+g(t.rightChild)}function w(t){return t.isLeaf?1:w(t.leftChild)+w(t.rightChild)}function d(t,e,r,o){for(var s=e,n=0;n<r.length;n++)s+=t[n]*r[n];return 0===s?l.tauRandInt(2,o):s>0?0:1}e.FlatTree=f},499(t,e,r){var o,s,n=this&&this.__createBinding||(Object.create?function(t,e,r,o){void 0===o&&(o=r);var s=Object.getOwnPropertyDescriptor(e,r);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,o,s)}:function(t,e,r,o){void 0===o&&(o=r),t[o]=e[r]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||(o=function(t){return o=Object.getOwnPropertyNames||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[e.length]=r);return e},o(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r=o(t),s=0;s<r.length;s++)"default"!==r[s]&&n(e,t,r[s]);return i(e,t),e}),u=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,s,n=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(t){s={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i},h=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.SparseMatrix=void 0,e.transpose=function(t){var e=[],r=[],o=[];t.forEach(function(t,s,n){e.push(s),r.push(n),o.push(t)});var s=[t.nCols,t.nRows];return new c(r,e,o,s)},e.identity=function(t){for(var e=u(t,1)[0],r=new c([],[],[],t),o=0;o<e;o++)r.set(o,o,1);return r},e.pairwiseMultiply=function(t,e){return m(t,e,function(t,e){return t*e})},e.add=function(t,e){return m(t,e,function(t,e){return t+e})},e.subtract=function(t,e){return m(t,e,function(t,e){return t-e})},e.maximum=function(t,e){return m(t,e,function(t,e){return t>e?t:e})},e.multiplyScalar=function(t,e){return t.map(function(t){return t*e})},e.eliminateZeros=function(t){for(var e=new Set,r=t.getValues(),o=t.getRows(),s=t.getCols(),n=0;n<r.length;n++)0===r[n]&&e.add(n);var i=function(t,r){return!e.has(r)},a=r.filter(i),u=o.filter(i),h=s.filter(i);return new c(u,h,a,t.getDims())},e.normalize=function(t,e){var r,o;void 0===e&&(e="l2");var s=f[e],n=new Map;t.forEach(function(t,e,r){var o=n.get(e)||[];o.push(r),n.set(e,o)});var i=new c([],[],[],t.getDims()),a=function(e){for(var r=n.get(e).sort(),o=r.map(function(r){return t.get(e,r)}),a=s(o),u=0;u<a.length;u++)i.set(e,r[u],a[u])};try{for(var u=h(n.keys()),l=u.next();!l.done;l=u.next())a(l.value)}catch(t){r={error:t}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}return i},e.getCSR=function(t){var e=[];t.forEach(function(t,r,o){e.push({value:t,row:r,col:o})}),e.sort(function(t,e){return t.row===e.row?t.col-e.col:t.row-e.row});for(var r=[],o=[],s=[],n=-1,i=0;i<e.length;i++){var a=e[i],u=a.row,h=a.col,l=a.value;u!==n&&(n=u,s.push(i)),r.push(h),o.push(l)}return{indices:r,values:o,indptr:s}};var l=a(r(185)),c=function(){function t(t,e,r,o){if(this.entries=new Map,this.nRows=0,this.nCols=0,t.length!==e.length||t.length!==r.length)throw new Error("rows, cols and values arrays must all have the same length");this.nRows=o[0],this.nCols=o[1];for(var s=0;s<r.length;s++){var n=t[s],i=e[s];this.checkDims(n,i);var a=this.makeKey(n,i);this.entries.set(a,{value:r[s],row:n,col:i})}}return t.prototype.makeKey=function(t,e){return"".concat(t,":").concat(e)},t.prototype.checkDims=function(t,e){if(!(t<this.nRows&&e<this.nCols))throw new Error("row and/or col specified outside of matrix dimensions")},t.prototype.set=function(t,e,r){this.checkDims(t,e);var o=this.makeKey(t,e);this.entries.has(o)?this.entries.get(o).value=r:this.entries.set(o,{value:r,row:t,col:e})},t.prototype.get=function(t,e,r){void 0===r&&(r=0),this.checkDims(t,e);var o=this.makeKey(t,e);return this.entries.has(o)?this.entries.get(o).value:r},t.prototype.getAll=function(t){void 0===t&&(t=!0);var e=[];return this.entries.forEach(function(t){e.push(t)}),t&&e.sort(function(t,e){return t.row===e.row?t.col-e.col:t.row-e.row}),e},t.prototype.getDims=function(){return[this.nRows,this.nCols]},t.prototype.getRows=function(){return Array.from(this.entries,function(t){var e=u(t,2);return e[0],e[1].row})},t.prototype.getCols=function(){return Array.from(this.entries,function(t){var e=u(t,2);return e[0],e[1].col})},t.prototype.getValues=function(){return Array.from(this.entries,function(t){var e=u(t,2);return e[0],e[1].value})},t.prototype.forEach=function(t){this.entries.forEach(function(e){return t(e.value,e.row,e.col)})},t.prototype.map=function(e){var r=[];this.entries.forEach(function(t){r.push(e(t.value,t.row,t.col))});var o=[this.nRows,this.nCols];return new t(this.getRows(),this.getCols(),r,o)},t.prototype.toArray=function(){var t=this,e=l.empty(this.nRows).map(function(){return l.zeros(t.nCols)});return this.entries.forEach(function(t){e[t.row][t.col]=t.value}),e},t}();e.SparseMatrix=c;var f=((s={}).max=function(t){for(var e=-1/0,r=0;r<t.length;r++)e=t[r]>e?t[r]:e;return t.map(function(t){return t/e})},s.l1=function(t){for(var e=0,r=0;r<t.length;r++)e+=t[r];return t.map(function(t){return t/e})},s.l2=function(t){for(var e=0,r=0;r<t.length;r++)e+=Math.pow(t[r],2);return t.map(function(t){return Math.sqrt(Math.pow(t,2)/e)})},s);function m(t,e,r){for(var o=new Set,s=[],n=[],i=[],a=function(o,a){s.push(o),n.push(a);var u=r(t.get(o,a),e.get(o,a));i.push(u)},u=t.getValues(),h=t.getRows(),l=t.getCols(),f=0;f<u.length;f++){var m=h[f],p=l[f],g="".concat(m,":").concat(p);o.add(g),a(m,p)}var w=e.getValues(),d=e.getRows(),y=e.getCols();for(f=0;f<w.length;f++)m=d[f],p=y[f],g="".concat(m,":").concat(p),o.has(g)||a(m,p);var b=[t.nRows,t.nCols];return new c(s,n,i,b)}},527(t,e,r){r.r(e),r.d(e,{default:()=>l});const o=Object.prototype.toString;function s(t){return o.call(t).endsWith("Array]")}function n(t,e,r){let o=0;const s=r(e);for(let e=0;e<t.x.length;e++)o+=Math.abs(t.y[e]-s(t.x[e]));return o}var i=r(673);i.y3,i.jy,i.oN,i.Hc,i.cg,i.hj,i.LU,i.Tb;const a=i.uq,u=(i.Zm,i.Dq,i.__,i.q0,i.lh,i.pI,i.zC,i.zg,i.g6,i.OL,i.ks,i.QR,i.jp,i.mk,i.W2,i.l,i.KY,i.dv,i.BR,i.Wu,i.uq,i.uq,i.a4,i.DI);function h(t,e,r,o,s){let n=r*o*o,i=a.eye(e.length,e.length,n);const h=s(e);let l=new Float64Array(t.x.length);for(let e=0;e<t.x.length;e++)l[e]=h(t.x[e]);let c=function(t,e,r,o,s){const n=r.length,i=t.x.length;let u=new Array(n);for(let a=0;a<n;a++){u[a]=new Array(i);let n=r.slice();n[a]+=o;let h=s(n);for(let r=0;r<i;r++)u[a][r]=e[r]-h(t.x[r])}return new a(u)}(t,l,e,o,s),f=function(t,e){const r=t.x.length;let o=new Array(r);for(let s=0;s<r;s++)o[s]=[t.y[s]-e[s]];return new a(o)}(t,l),m=u(i.add(c.mmul(c.transpose())));return(e=(e=new a([e])).sub(m.mmul(c).mmul(f).mul(o).transpose())).to1DArray()}function l(t,e,r={}){let{maxIterations:o=100,gradientDifference:i=.1,damping:a=0,errorTolerance:u=.01,minValues:l,maxValues:c,initialValues:f}=r;if(a<=0)throw new Error("The damping option must be a positive number");if(!t.x||!t.y)throw new Error("The data parameter must have x and y elements");if(!s(t.x)||t.x.length<2||!s(t.y)||t.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(t.x.length!==t.y.length)throw new Error("The data parameter elements must have the same size");let m=f||new Array(e.length).fill(1),p=m.length;if(c=c||new Array(p).fill(Number.MAX_SAFE_INTEGER),l=l||new Array(p).fill(Number.MIN_SAFE_INTEGER),c.length!==l.length)throw new Error("minValues and maxValues must be the same size");if(!s(m))throw new Error("initialValues must be an array");let g,w=n(t,m,e),d=w<=u;for(g=0;g<o&&!d;g++){m=h(t,m,a,i,e);for(let t=0;t<p;t++)m[t]=Math.min(Math.max(l[t],m[t]),c[t]);if(w=n(t,m,e),isNaN(w))break;d=w<=u}return{parameterValues:m,parameterError:w,iterations:g}}i.Jo,i.Zi,i.kH,i.LV},673(t,e,r){var o=r(788),s=r(718);const n=" ".repeat(2),i=" ".repeat(4);function a(t,e={}){const{maxRows:r=15,maxColumns:o=10,maxNumSize:s=8,padMinus:a="auto"}=e;return`${t.constructor.name} {\n${n}[\n${i}${function(t,e,r,o,s){const{rows:n,columns:a}=t,h=Math.min(n,e),l=Math.min(a,r),c=[];if("auto"===s){s=!1;t:for(let e=0;e<h;e++)for(let r=0;r<l;r++)if(t.get(e,r)<0){s=!0;break t}}for(let e=0;e<h;e++){let r=[];for(let n=0;n<l;n++)r.push(u(t.get(e,n),o,s));c.push(`${r.join(" ")}`)}return l!==a&&(c[c.length-1]+=` ... ${a-r} more columns`),h!==n&&c.push(`... ${n-e} more rows`),c.join(`\n${i}`)}(t,r,o,s,a)}\n${n}]\n${n}rows: ${t.rows}\n${n}columns: ${t.columns}\n}`}function u(t,e,r){return(t>=0&&r?` ${h(t,e-1)}`:h(t,e)).padEnd(e)}function h(t,e){let r=t.toString();if(r.length<=e)return r;let o=t.toFixed(e);if(o.length>e&&(o=t.toFixed(Math.max(0,e-(o.length-e)))),o.length<=e&&!o.startsWith("0.000")&&!o.startsWith("-0.000"))return o;let s=t.toExponential(e);return s.length>e&&(s=t.toExponential(Math.max(0,e-(s.length-e)))),s.slice(0)}function l(t,e,r){let o=r?t.rows:t.rows-1;if(e<0||e>o)throw new RangeError("Row index out of range")}function c(t,e,r){let o=r?t.columns:t.columns-1;if(e<0||e>o)throw new RangeError("Column index out of range")}function f(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function m(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function p(t,e){if(!o.isAnyArray(e))throw new TypeError("row indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=t.rows)throw new RangeError("row indices are out of range")}function g(t,e){if(!o.isAnyArray(e))throw new TypeError("column indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=t.columns)throw new RangeError("column indices are out of range")}function w(t,e,r,o,s){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(y("startRow",e),y("endRow",r),y("startColumn",o),y("endColumn",s),e>r||o>s||e<0||e>=t.rows||r<0||r>=t.rows||o<0||o>=t.columns||s<0||s>=t.columns)throw new RangeError("Submatrix indices are out of range")}function d(t,e=0){let r=[];for(let o=0;o<t;o++)r.push(e);return r}function y(t,e){if("number"!=typeof e)throw new TypeError(`${t} must be a number`)}function b(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}class v{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let o=new S(t,e);for(let s=0;s<t;s++)for(let t=0;t<e;t++)o.set(s,t,r[s*e+t]);return o}static rowVector(t){let e=new S(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new S(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new S(t,e)}static ones(t,e){return new S(t,e).fill(1)}static rand(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{random:o=Math.random}=r;let s=new S(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)s.set(r,t,o());return s}static randInt(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{min:o=0,max:s=1e3,random:n=Math.random}=r;if(!Number.isInteger(o))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(o>=s)throw new RangeError("min must be smaller than max");let i=s-o,a=new S(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=o+Math.round(n()*i);a.set(r,t,e)}return a}static eye(t,e,r){void 0===e&&(e=t),void 0===r&&(r=1);let o=Math.min(t,e),s=this.zeros(t,e);for(let t=0;t<o;t++)s.set(t,t,r);return s}static diag(t,e,r){let o=t.length;void 0===e&&(e=o),void 0===r&&(r=e);let s=Math.min(o,e,r),n=this.zeros(e,r);for(let e=0;e<s;e++)n.set(e,e,t[e]);return n}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,s=new S(r,o);for(let n=0;n<r;n++)for(let r=0;r<o;r++)s.set(n,r,Math.min(t.get(n,r),e.get(n,r)));return s}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,s=new this(r,o);for(let n=0;n<r;n++)for(let r=0;r<o;r++)s.set(n,r,Math.max(t.get(n,r),e.get(n,r)));return s}static checkMatrix(t){return v.isMatrix(t)?t:new S(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isEmpty(){return 0===this.rows||0===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let t=0;t<this.rows;t++)if(0!==this.get(t,t))return!1;return!0}isEchelonForm(){let t=0,e=0,r=-1,o=!0,s=!1;for(;t<this.rows&&o;){for(e=0,s=!1;e<this.columns&&!1===s;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(s=!0,r=e):(o=!1,s=!0);t++}return o}isReducedEchelonForm(){let t=0,e=0,r=-1,o=!0,s=!1;for(;t<this.rows&&o;){for(e=0,s=!1;e<this.columns&&!1===s;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(s=!0,r=e):(o=!1,s=!0);for(let r=e+1;r<this.rows;r++)0!==this.get(t,r)&&(o=!1);t++}return o}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let o=e;for(let s=e;s<t.rows;s++)t.get(s,r)>t.get(o,r)&&(o=s);if(0===t.get(o,r))r++;else{t.swapRows(e,o);let s=t.get(e,r);for(let o=r;o<t.columns;o++)t.set(e,o,t.get(e,o)/s);for(let o=e+1;o<t.rows;o++){let s=t.get(o,r)/t.get(e,r);t.set(o,r,0);for(let n=r+1;n<t.columns;n++)t.set(o,n,t.get(o,n)-t.get(e,n)*s)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,o=r-1;for(;o>=0;)if(0===t.maxRow(o))o--;else{let s=0,n=!1;for(;s<r&&!1===n;)1===t.get(o,s)?n=!0:s++;for(let r=0;r<o;r++){let n=t.get(r,s);for(let i=s;i<e;i++){let e=t.get(r,i)-n*t.get(o,i);t.set(r,i,e)}}o--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let o=new S(this.rows*e,this.columns*r);for(let t=0;t<e;t++)for(let e=0;e<r;e++)o.setSubMatrix(this,this.rows*t,this.columns*e);return o}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){l(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return S.rowVector(this.getRow(t))}setRow(t,e){l(this,t),e=f(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){l(this,t),l(this,e);for(let r=0;r<this.columns;r++){let o=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,o)}return this}getColumn(t){c(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return S.columnVector(this.getColumn(t))}setColumn(t,e){c(this,t),e=m(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){c(this,t),c(this,e);for(let r=0;r<this.rows;r++){let o=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,o)}return this}addRowVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=m(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=m(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=m(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=m(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){l(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){c(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const t=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t[e]&&(t[e]=this.get(e,r));return t}case"column":{const t=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t[r]&&(t[r]=this.get(e,r));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){b(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)>t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const t=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t[e]&&(t[e]=this.get(e,r));return t}case"column":{const t=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t[r]&&(t[r]=this.get(e,r));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}default:throw new Error(`invalid option: ${t}`)}}minIndex(){b(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)<t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}maxRow(t){if(l(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){l(this,t),b(this);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)>e&&(e=this.get(t,o),r[1]=o);return r}minRow(t){if(l(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){l(this,t),b(this);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)<e&&(e=this.get(t,o),r[1]=o);return r}maxColumn(t){if(c(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){c(this,t),b(this);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)>e&&(e=this.get(o,t),r[0]=o);return r}minColumn(t){if(c(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){c(this,t),b(this);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)<e&&(e=this.get(o,t),r[0]=o);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){switch(t){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${t}`)}}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){v.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let o=0;o<e.length;o++)r+=e[o]*t[o];return r}mmul(t){t=S.checkMatrix(t);let e=this.rows,r=this.columns,o=t.columns,s=new S(e,o),n=new Float64Array(r);for(let i=0;i<o;i++){for(let e=0;e<r;e++)n[e]=t.get(e,i);for(let t=0;t<e;t++){let e=0;for(let o=0;o<r;o++)e+=this.get(t,o)*n[o];s.set(t,i,e)}}return s}mpow(t){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(t)||t<0)throw new RangeError("Exponent must be a non-negative integer");let e=S.eye(this.rows),r=this;for(let o=t;o>=1;o/=2)1&o&&(e=e.mmul(r)),r=r.mmul(r);return e}strassen2x2(t){t=S.checkMatrix(t);let e=new S(2,2);const r=this.get(0,0),o=t.get(0,0),s=this.get(0,1),n=t.get(0,1),i=this.get(1,0),a=t.get(1,0),u=this.get(1,1),h=t.get(1,1),l=(r+u)*(o+h),c=(i+u)*o,f=r*(n-h),m=u*(a-o),p=(r+s)*h,g=l+m-p+(s-u)*(a+h),w=f+p,d=c+m,y=l-c+f+(i-r)*(o+n);return e.set(0,0,g),e.set(0,1,w),e.set(1,0,d),e.set(1,1,y),e}strassen3x3(t){t=S.checkMatrix(t);let e=new S(3,3);const r=this.get(0,0),o=this.get(0,1),s=this.get(0,2),n=this.get(1,0),i=this.get(1,1),a=this.get(1,2),u=this.get(2,0),h=this.get(2,1),l=this.get(2,2),c=t.get(0,0),f=t.get(0,1),m=t.get(0,2),p=t.get(1,0),g=t.get(1,1),w=t.get(1,2),d=t.get(2,0),y=t.get(2,1),b=t.get(2,2),v=(r-n)*(-f+g),M=(-r+n+i)*(c-f+g),x=(n+i)*(-c+f),_=r*c,E=(-r+u+h)*(c-m+w),A=(-r+u)*(m-w),R=(u+h)*(-c+m),k=(-s+h+l)*(g+d-y),N=(s-l)*(g-y),z=s*d,T=(h+l)*(-d+y),W=(-s+i+a)*(w+d-b),I=(s-a)*(w-b),P=(i+a)*(-d+b),O=_+z+o*p,j=(r+o+s-n-i-h-l)*g+M+x+_+k+z+T,C=_+E+R+(r+o+s-i-a-u-h)*w+z+W+P,q=v+i*(-c+f+p-g-w-d+b)+M+_+z+W+I,F=v+M+x+_+a*y,D=z+W+I+P+n*m,V=_+E+A+h*(-c+m+p-g-w-d+y)+k+N+z,L=k+N+z+T+u*f,$=_+E+A+R+l*b;return e.set(0,0,O),e.set(0,1,j),e.set(0,2,C),e.set(1,0,q),e.set(1,1,F),e.set(1,2,D),e.set(2,0,V),e.set(2,1,L),e.set(2,2,$),e}mmulStrassen(t){t=S.checkMatrix(t);let e=this.clone(),r=e.rows,o=e.columns,s=t.rows,n=t.columns;function i(t,e,r){let o=t.rows,s=t.columns;if(o===e&&s===r)return t;{let o=v.zeros(e,r);return o=o.setSubMatrix(t,0,0),o}}o!==s&&console.warn(`Multiplying ${r} x ${o} and ${s} x ${n} matrix: dimensions do not match.`);let a=Math.max(r,s),u=Math.max(o,n);return e=i(e,a,u),function t(e,r,o,s){if(o<=512||s<=512)return e.mmul(r);o%2==1&&s%2==1?(e=i(e,o+1,s+1),r=i(r,o+1,s+1)):o%2==1?(e=i(e,o+1,s),r=i(r,o+1,s)):s%2==1&&(e=i(e,o,s+1),r=i(r,o,s+1));let n=parseInt(e.rows/2,10),a=parseInt(e.columns/2,10),u=e.subMatrix(0,n-1,0,a-1),h=r.subMatrix(0,n-1,0,a-1),l=e.subMatrix(0,n-1,a,e.columns-1),c=r.subMatrix(0,n-1,a,r.columns-1),f=e.subMatrix(n,e.rows-1,0,a-1),m=r.subMatrix(n,r.rows-1,0,a-1),p=e.subMatrix(n,e.rows-1,a,e.columns-1),g=r.subMatrix(n,r.rows-1,a,r.columns-1),w=t(v.add(u,p),v.add(h,g),n,a),d=t(v.add(f,p),h,n,a),y=t(u,v.sub(c,g),n,a),b=t(p,v.sub(m,h),n,a),M=t(v.add(u,l),g,n,a),x=t(v.sub(f,u),v.add(h,c),n,a),S=t(v.sub(l,p),v.add(m,g),n,a),_=v.add(w,b);_.sub(M),_.add(S);let E=v.add(y,M),A=v.add(d,b),R=v.sub(w,d);R.add(y),R.add(x);let k=v.zeros(2*_.rows,2*_.columns);return k=k.setSubMatrix(_,0,0),k=k.setSubMatrix(E,_.rows,0),k=k.setSubMatrix(A,0,_.columns),k=k.setSubMatrix(R,_.rows,_.columns),k.subMatrix(0,o-1,0,s-1)}(e,t=i(t,a,u),a,u)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new S(this.rows,this.columns);for(let t=0;t<this.rows;t++){const n=this.getRow(t);n.length>0&&s(n,{min:e,max:r,output:n}),o.setRow(t,n)}return o}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new S(this.rows,this.columns);for(let t=0;t<this.columns;t++){const n=this.getColumn(t);n.length&&s(n,{min:e,max:r,output:n}),o.setColumn(t,n)}return o}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let t=this.get(e,r),o=this.get(e,this.columns-1-r);this.set(e,r,o),this.set(e,this.columns-1-r,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let t=this.get(r,e),o=this.get(this.rows-1-r,e);this.set(r,e,o),this.set(this.rows-1-r,e,t)}return this}kroneckerProduct(t){t=S.checkMatrix(t);let e=this.rows,r=this.columns,o=t.rows,s=t.columns,n=new S(e*o,r*s);for(let i=0;i<e;i++)for(let e=0;e<r;e++)for(let r=0;r<o;r++)for(let a=0;a<s;a++)n.set(o*i+r,s*e+a,this.get(i,e)*t.get(r,a));return n}kroneckerSum(t){if(t=S.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,r=t.rows,o=this.kroneckerProduct(S.eye(r,r)),s=S.eye(e,e).kroneckerProduct(t);return o.add(s)}transpose(){let t=new S(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=M){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=M){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,o){w(this,t,e,r,o);let s=new S(e-t+1,o-r+1);for(let n=t;n<=e;n++)for(let e=r;e<=o;e++)s.set(n-t,e-r,this.get(n,e));return s}subMatrixRow(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let o=new S(t.length,r-e+1);for(let s=0;s<t.length;s++)for(let n=e;n<=r;n++){if(t[s]<0||t[s]>=this.rows)throw new RangeError(`Row index out of range: ${t[s]}`);o.set(s,n-e,this.get(t[s],n))}return o}subMatrixColumn(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let o=new S(r-e+1,t.length);for(let s=0;s<t.length;s++)for(let n=e;n<=r;n++){if(t[s]<0||t[s]>=this.columns)throw new RangeError(`Column index out of range: ${t[s]}`);o.set(n-e,s,this.get(n,t[s]))}return o}setSubMatrix(t,e,r){if((t=S.checkMatrix(t)).isEmpty())return this;w(this,e,e+t.rows-1,r,r+t.columns-1);for(let o=0;o<t.rows;o++)for(let s=0;s<t.columns;s++)this.set(e+o,r+s,t.get(o,s));return this}selection(t,e){p(this,t),g(this,e);let r=new S(t.length,e.length);for(let o=0;o<t.length;o++){let s=t[o];for(let t=0;t<e.length;t++){let n=e[t];r.set(o,t,this.get(s,n))}}return r}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){return this.constructor.copy(this,new S(this.rows,this.columns))}static copy(t,e){for(const[r,o,s]of t.entries())e.set(r,o,s);return e}sum(t){switch(t){case"row":return function(t){let e=d(t.rows);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[r]+=t.get(r,o);return e}(this);case"column":return function(t){let e=d(t.columns);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[o]+=t.get(r,o);return e}(this);case void 0:return function(t){let e=0;for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)e+=t.get(r,o);return e}(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return function(t){let e=d(t.rows,1);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[r]*=t.get(r,o);return e}(this);case"column":return function(t){let e=d(t.columns,1);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[o]*=t.get(r,o);return e}(this);case void 0:return function(t){let e=1;for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)e*=t.get(r,o);return e}(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:r=!0,mean:s=this.mean(t)}=e;if("boolean"!=typeof r)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!o.isAnyArray(s))throw new TypeError("mean must be an array");return function(t,e,r){const o=t.rows,s=t.columns,n=[];for(let i=0;i<o;i++){let o=0,a=0,u=0;for(let e=0;e<s;e++)u=t.get(i,e)-r[i],o+=u,a+=u*u;e?n.push((a-o*o/s)/(s-1)):n.push((a-o*o/s)/s)}return n}(this,r,s);case"column":if(!o.isAnyArray(s))throw new TypeError("mean must be an array");return function(t,e,r){const o=t.rows,s=t.columns,n=[];for(let i=0;i<s;i++){let s=0,a=0,u=0;for(let e=0;e<o;e++)u=t.get(e,i)-r[i],s+=u,a+=u*u;e?n.push((a-s*s/o)/(o-1)):n.push((a-s*s/o)/o)}return n}(this,r,s);case void 0:if("number"!=typeof s)throw new TypeError("mean must be a number");return function(t,e,r){const o=t.rows,s=t.columns,n=o*s;let i=0,a=0,u=0;for(let e=0;e<o;e++)for(let o=0;o<s;o++)u=t.get(e,o)-r,i+=u,a+=u*u;return e?(a-i*i/n)/(n-1):(a-i*i/n)/n}(this,r,s);default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const r=this.variance(t,e);if(void 0===t)return Math.sqrt(r);for(let t=0;t<r.length;t++)r[t]=Math.sqrt(r[t]);return r}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":if(!o.isAnyArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e[r])}(this,r),this;case"column":if(!o.isAnyArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e[o])}(this,r),this;case void 0:if("number"!=typeof r)throw new TypeError("center must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e)}(this,r),this;default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.rows;r++){let o=0;for(let e=0;e<t.columns;e++)o+=t.get(r,e)**2/(t.columns-1);e.push(Math.sqrt(o))}return e}(this);else if(!o.isAnyArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e[r])}(this,r),this;case"column":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.columns;r++){let o=0;for(let e=0;e<t.rows;e++)o+=t.get(e,r)**2/(t.rows-1);e.push(Math.sqrt(o))}return e}(this);else if(!o.isAnyArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e[o])}(this,r),this;case void 0:if(void 0===r)r=function(t){const e=t.size-1;let r=0;for(let o=0;o<t.columns;o++)for(let s=0;s<t.rows;s++)r+=t.get(s,o)**2/e;return Math.sqrt(r)}(this);else if("number"!=typeof r)throw new TypeError("scale must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e)}(this,r),this;default:throw new Error(`invalid option: ${t}`)}}toString(t){return a(this,t)}[Symbol.iterator](){return this.entries()}*entries(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield[t,e,this.get(t,e)]}*values(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield this.get(t,e)}}function M(t,e){return t-e}function x(t){return t.every(t=>"number"==typeof t)}v.prototype.klass="Matrix","undefined"!=typeof Symbol&&(v.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return a(this)}),v.random=v.rand,v.randomInt=v.randInt,v.diagonal=v.diag,v.prototype.diagonal=v.prototype.diag,v.identity=v.eye,v.prototype.negate=v.prototype.neg,v.prototype.tensorProduct=v.prototype.kroneckerProduct;class S extends v{data;#t(t,e){if(this.data=[],!(Number.isInteger(e)&&e>=0))throw new TypeError("nColumns must be a positive integer");for(let r=0;r<t;r++)this.data.push(new Float64Array(e));this.rows=t,this.columns=e}constructor(t,e){if(super(),S.isMatrix(t))this.#t(t.rows,t.columns),S.copy(t,this);else if(Number.isInteger(t)&&t>=0)this.#t(t,e);else{if(!o.isAnyArray(t))throw new TypeError("First argument must be a positive number or an array");{const r=t;if("number"!=typeof(e=(t=r.length)?r[0].length:0))throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let o=0;o<t;o++){if(r[o].length!==e)throw new RangeError("Inconsistent array dimensions");if(!x(r[o]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(r[o]))}this.rows=t,this.columns=e}}}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){return l(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),l(this,t,!0),e=Float64Array.from(f(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){c(this,t);for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let o=0;o<t;o++)r[o]=this.data[e][o];for(let o=t+1;o<this.columns;o++)r[o-1]=this.data[e][o];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),c(this,t,!0),e=m(this,e);for(let r=0;r<this.rows;r++){const o=new Float64Array(this.columns+1);let s=0;for(;s<t;s++)o[s]=this.data[r][s];for(o[s++]=e[r];s<this.columns+1;s++)o[s]=this.data[r][s-1];this.data[r]=o}return this.columns+=1,this}}!function(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t.get(e,r));return this},t.add=function(t,r){return new e(t).add(r)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t.get(e,r));return this},t.sub=function(t,r){return new e(t).sub(r)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t.get(e,r));return this},t.mul=function(t,r){return new e(t).mul(r)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t.get(e,r));return this},t.div=function(t,r){return new e(t).div(r)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t.get(e,r));return this},t.mod=function(t,r){return new e(t).mod(r)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t.get(e,r));return this},t.and=function(t,r){return new e(t).and(r)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t.get(e,r));return this},t.or=function(t,r){return new e(t).or(r)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t.get(e,r));return this},t.xor=function(t,r){return new e(t).xor(r)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t.get(e,r));return this},t.leftShift=function(t,r){return new e(t).leftShift(r)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t.get(e,r));return this},t.signPropagatingRightShift=function(t,r){return new e(t).signPropagatingRightShift(r)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t.get(e,r));return this},t.rightShift=function(t,r){return new e(t).rightShift(r)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,r){return new e(t).pow(r)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)**t);return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)**t.get(e,r));return this}}(v,S);class _ extends v{#e;get size(){return this.#e.size}get rows(){return this.#e.rows}get columns(){return this.#e.columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(t){return S.isMatrix(t)&&"SymmetricMatrix"===t.klassType}static zeros(t){return new this(t)}static ones(t){return new this(t).fill(1)}constructor(t){if(super(),S.isMatrix(t)){if(!t.isSymmetric())throw new TypeError("not symmetric data");this.#e=S.copy(t,new S(t.rows,t.rows))}else if(Number.isInteger(t)&&t>=0)this.#e=new S(t,t);else if(this.#e=new S(t),!this.isSymmetric())throw new TypeError("not symmetric data")}clone(){const t=new _(this.diagonalSize);for(const[e,r,o]of this.upperRightEntries())t.set(e,r,o);return t}toMatrix(){return new S(this)}get(t,e){return this.#e.get(t,e)}set(t,e,r){return this.#e.set(t,e,r),this.#e.set(e,t,r),this}removeCross(t){return this.#e.removeRow(t),this.#e.removeColumn(t),this}addCross(t,e){void 0===e&&(e=t,t=this.diagonalSize);const r=e.slice();return r.splice(t,1),this.#e.addRow(t,r),this.#e.addColumn(t,e),this}applyMask(t){if(t.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const e=[];for(const[r,o]of t.entries())o||e.push(r);e.reverse();for(const t of e)this.removeCross(t);return this}toCompact(){const{diagonalSize:t}=this,e=new Array(t*(t+1)/2);for(let r=0,o=0,s=0;s<e.length;s++)e[s]=this.get(o,r),++r>=t&&(r=++o);return e}static fromCompact(t){const e=t.length,r=(Math.sqrt(8*e+1)-1)/2;if(!Number.isInteger(r))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(t)}`);const o=new _(r);for(let s=0,n=0,i=0;i<e;i++)o.set(s,n,t[i]),++s>=r&&(s=++n);return o}*upperRightEntries(){for(let t=0,e=0;t<this.diagonalSize;void 0){const r=this.get(t,e);yield[t,e,r],++e>=this.diagonalSize&&(e=++t)}}*upperRightValues(){for(let t=0,e=0;t<this.diagonalSize;void 0){const r=this.get(t,e);yield r,++e>=this.diagonalSize&&(e=++t)}}}_.prototype.klassType="SymmetricMatrix";class E extends _{static isDistanceMatrix(t){return _.isSymmetricMatrix(t)&&"DistanceMatrix"===t.klassSubType}constructor(t){if(super(t),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(t,e,r){return t===e&&(r=0),super.set(t,e,r)}addCross(t,e){return void 0===e&&(e=t,t=this.diagonalSize),(e=e.slice())[t]=0,super.addCross(t,e)}toSymmetricMatrix(){return new _(this)}clone(){const t=new E(this.diagonalSize);for(const[e,r,o]of this.upperRightEntries())e!==r&&t.set(e,r,o);return t}toCompact(){const{diagonalSize:t}=this,e=new Array((t-1)*t/2);for(let r=1,o=0,s=0;s<e.length;s++)e[s]=this.get(o,r),++r>=t&&(r=1+ ++o);return e}static fromCompact(t){const e=t.length;if(0===e)return new this(0);const r=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(r))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(t)}`);const o=new this(r);for(let s=1,n=0,i=0;i<e;i++)o.set(s,n,t[i]),++s>=r&&(s=1+ ++n);return o}}E.prototype.klassSubType="DistanceMatrix";class A extends v{constructor(t,e,r){super(),this.matrix=t,this.rows=e,this.columns=r}}class R extends A{constructor(t,e,r){p(t,e),g(t,r),super(t,e.length,r.length),this.rowIndices=e,this.columnIndices=r}set(t,e,r){return this.matrix.set(this.rowIndices[t],this.columnIndices[e],r),this}get(t,e){return this.matrix.get(this.rowIndices[t],this.columnIndices[e])}}class k extends v{constructor(t,e={}){const{rows:r=1}=e;if(t.length%r!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=r,this.columns=t.length/r,this.data=t}set(t,e,r){let o=this._calculateIndex(t,e);return this.data[o]=r,this}get(t,e){let r=this._calculateIndex(t,e);return this.data[r]}_calculateIndex(t,e){return t*this.columns+e}}class N extends v{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}}class z{constructor(t){let e,r,o,s,n,i,a,u,h,l=(t=N.checkMatrix(t)).clone(),c=l.rows,f=l.columns,m=new Float64Array(c),p=1;for(e=0;e<c;e++)m[e]=e;for(u=new Float64Array(c),r=0;r<f;r++){for(e=0;e<c;e++)u[e]=l.get(e,r);for(e=0;e<c;e++){for(h=Math.min(e,r),n=0,o=0;o<h;o++)n+=l.get(e,o)*u[o];u[e]-=n,l.set(e,r,u[e])}for(s=r,e=r+1;e<c;e++)Math.abs(u[e])>Math.abs(u[s])&&(s=e);if(s!==r){for(o=0;o<f;o++)i=l.get(s,o),l.set(s,o,l.get(r,o)),l.set(r,o,i);a=m[s],m[s]=m[r],m[r]=a,p=-p}if(r<c&&0!==l.get(r,r))for(e=r+1;e<c;e++)l.set(e,r,l.get(e,r)/l.get(r,r))}this.LU=l,this.pivotVector=m,this.pivotSign=p}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(0===t.get(r,r))return!0;return!1}solve(t){t=S.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r,o,s,n=t.columns,i=t.subMatrixRow(this.pivotVector,0,n-1),a=e.columns;for(s=0;s<a;s++)for(r=s+1;r<a;r++)for(o=0;o<n;o++)i.set(r,o,i.get(r,o)-i.get(s,o)*e.get(r,s));for(s=a-1;s>=0;s--){for(o=0;o<n;o++)i.set(s,o,i.get(s,o)/e.get(s,s));for(r=0;r<s;r++)for(o=0;o<n;o++)i.set(r,o,i.get(r,o)-i.get(s,o)*e.get(r,s))}return i}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let o=0;o<r;o++)e*=t.get(o,o);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new S(e,r);for(let s=0;s<e;s++)for(let e=0;e<r;e++)s>e?o.set(s,e,t.get(s,e)):s===e?o.set(s,e,1):o.set(s,e,0);return o}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new S(e,r);for(let s=0;s<e;s++)for(let e=0;e<r;e++)s<=e?o.set(s,e,t.get(s,e)):o.set(s,e,0);return o}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function T(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0!==e?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class W{constructor(t){let e,r,o,s,n=(t=N.checkMatrix(t)).clone(),i=t.rows,a=t.columns,u=new Float64Array(a);for(o=0;o<a;o++){let t=0;for(e=o;e<i;e++)t=T(t,n.get(e,o));if(0!==t){for(n.get(o,o)<0&&(t=-t),e=o;e<i;e++)n.set(e,o,n.get(e,o)/t);for(n.set(o,o,n.get(o,o)+1),r=o+1;r<a;r++){for(s=0,e=o;e<i;e++)s+=n.get(e,o)*n.get(e,r);for(s=-s/n.get(o,o),e=o;e<i;e++)n.set(e,r,n.get(e,r)+s*n.get(e,o))}}u[o]=-t}this.QR=n,this.Rdiag=u}solve(t){t=S.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let o,s,n,i,a=t.columns,u=t.clone(),h=e.columns;for(n=0;n<h;n++)for(s=0;s<a;s++){for(i=0,o=n;o<r;o++)i+=e.get(o,n)*u.get(o,s);for(i=-i/e.get(n,n),o=n;o<r;o++)u.set(o,s,u.get(o,s)+i*e.get(o,n))}for(n=h-1;n>=0;n--){for(s=0;s<a;s++)u.set(n,s,u.get(n,s)/this.Rdiag[n]);for(o=0;o<n;o++)for(s=0;s<a;s++)u.set(o,s,u.get(o,s)-u.get(n,s)*e.get(o,n))}return u.subMatrix(0,h-1,0,a-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,r=this.QR,o=r.columns,s=new S(o,o);for(t=0;t<o;t++)for(e=0;e<o;e++)t<e?s.set(t,e,r.get(t,e)):t===e?s.set(t,e,this.Rdiag[t]):s.set(t,e,0);return s}get orthogonalMatrix(){let t,e,r,o,s=this.QR,n=s.rows,i=s.columns,a=new S(n,i);for(r=i-1;r>=0;r--){for(t=0;t<n;t++)a.set(t,r,0);for(a.set(r,r,1),e=r;e<i;e++)if(0!==s.get(r,r)){for(o=0,t=r;t<n;t++)o+=s.get(t,r)*a.get(t,e);for(o=-o/s.get(r,r),t=r;t<n;t++)a.set(t,e,a.get(t,e)+o*s.get(t,r))}}return a}}class I{constructor(t,e={}){if((t=N.checkMatrix(t)).isEmpty())throw new Error("Matrix must be non-empty");let r=t.rows,o=t.columns;const{computeLeftSingularVectors:s=!0,computeRightSingularVectors:n=!0,autoTranspose:i=!1}=e;let a,u=Boolean(s),h=Boolean(n),l=!1;if(r<o)if(i){a=t.transpose(),r=a.rows,o=a.columns,l=!0;let e=u;u=h,h=e}else a=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else a=t.clone();let c=Math.min(r,o),f=Math.min(r+1,o),m=new Float64Array(f),p=new S(r,c),g=new S(o,o),w=new Float64Array(o),d=new Float64Array(r),y=new Float64Array(f);for(let t=0;t<f;t++)y[t]=t;let b=Math.min(r-1,o),v=Math.max(0,Math.min(o-2,r)),M=Math.max(b,v);for(let t=0;t<M;t++){if(t<b){m[t]=0;for(let e=t;e<r;e++)m[t]=T(m[t],a.get(e,t));if(0!==m[t]){a.get(t,t)<0&&(m[t]=-m[t]);for(let e=t;e<r;e++)a.set(e,t,a.get(e,t)/m[t]);a.set(t,t,a.get(t,t)+1)}m[t]=-m[t]}for(let e=t+1;e<o;e++){if(t<b&&0!==m[t]){let o=0;for(let s=t;s<r;s++)o+=a.get(s,t)*a.get(s,e);o=-o/a.get(t,t);for(let s=t;s<r;s++)a.set(s,e,a.get(s,e)+o*a.get(s,t))}w[e]=a.get(t,e)}if(u&&t<b)for(let e=t;e<r;e++)p.set(e,t,a.get(e,t));if(t<v){w[t]=0;for(let e=t+1;e<o;e++)w[t]=T(w[t],w[e]);if(0!==w[t]){w[t+1]<0&&(w[t]=0-w[t]);for(let e=t+1;e<o;e++)w[e]/=w[t];w[t+1]+=1}if(w[t]=-w[t],t+1<r&&0!==w[t]){for(let e=t+1;e<r;e++)d[e]=0;for(let e=t+1;e<r;e++)for(let r=t+1;r<o;r++)d[e]+=w[r]*a.get(e,r);for(let e=t+1;e<o;e++){let o=-w[e]/w[t+1];for(let s=t+1;s<r;s++)a.set(s,e,a.get(s,e)+o*d[s])}}if(h)for(let e=t+1;e<o;e++)g.set(e,t,w[e])}}let x=Math.min(o,r+1);if(b<o&&(m[b]=a.get(b,b)),r<x&&(m[x-1]=0),v+1<x&&(w[v]=a.get(v,x-1)),w[x-1]=0,u){for(let t=b;t<c;t++){for(let e=0;e<r;e++)p.set(e,t,0);p.set(t,t,1)}for(let t=b-1;t>=0;t--)if(0!==m[t]){for(let e=t+1;e<c;e++){let o=0;for(let s=t;s<r;s++)o+=p.get(s,t)*p.get(s,e);o=-o/p.get(t,t);for(let s=t;s<r;s++)p.set(s,e,p.get(s,e)+o*p.get(s,t))}for(let e=t;e<r;e++)p.set(e,t,-p.get(e,t));p.set(t,t,1+p.get(t,t));for(let e=0;e<t-1;e++)p.set(e,t,0)}else{for(let e=0;e<r;e++)p.set(e,t,0);p.set(t,t,1)}}if(h)for(let t=o-1;t>=0;t--){if(t<v&&0!==w[t])for(let e=t+1;e<o;e++){let r=0;for(let s=t+1;s<o;s++)r+=g.get(s,t)*g.get(s,e);r=-r/g.get(t+1,t);for(let s=t+1;s<o;s++)g.set(s,e,g.get(s,e)+r*g.get(s,t))}for(let e=0;e<o;e++)g.set(e,t,0);g.set(t,t,1)}let _=x-1,E=Number.EPSILON;for(;x>0;){let t,e;for(t=x-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+E*Math.abs(m[t]+Math.abs(m[t+1]));if(Math.abs(w[t])<=e||Number.isNaN(w[t])){w[t]=0;break}}if(t===x-2)e=4;else{let r;for(r=x-1;r>=t&&r!==t;r--){let e=(r!==x?Math.abs(w[r]):0)+(r!==t+1?Math.abs(w[r-1]):0);if(Math.abs(m[r])<=E*e){m[r]=0;break}}r===t?e=3:r===x-1?e=1:(e=2,t=r)}switch(t++,e){case 1:{let e=w[x-2];w[x-2]=0;for(let r=x-2;r>=t;r--){let s=T(m[r],e),n=m[r]/s,i=e/s;if(m[r]=s,r!==t&&(e=-i*w[r-1],w[r-1]=n*w[r-1]),h)for(let t=0;t<o;t++)s=n*g.get(t,r)+i*g.get(t,x-1),g.set(t,x-1,-i*g.get(t,r)+n*g.get(t,x-1)),g.set(t,r,s)}break}case 2:{let e=w[t-1];w[t-1]=0;for(let o=t;o<x;o++){let s=T(m[o],e),n=m[o]/s,i=e/s;if(m[o]=s,e=-i*w[o],w[o]=n*w[o],u)for(let e=0;e<r;e++)s=n*p.get(e,o)+i*p.get(e,t-1),p.set(e,t-1,-i*p.get(e,o)+n*p.get(e,t-1)),p.set(e,o,s)}break}case 3:{const e=Math.max(Math.abs(m[x-1]),Math.abs(m[x-2]),Math.abs(w[x-2]),Math.abs(m[t]),Math.abs(w[t])),s=m[x-1]/e,n=m[x-2]/e,i=w[x-2]/e,a=m[t]/e,l=w[t]/e,c=((n+s)*(n-s)+i*i)/2,f=s*i*(s*i);let d=0;0===c&&0===f||(d=c<0?0-Math.sqrt(c*c+f):Math.sqrt(c*c+f),d=f/(c+d));let y=(a+s)*(a-s)+d,b=a*l;for(let e=t;e<x-1;e++){let s=T(y,b);0===s&&(s=Number.MIN_VALUE);let n=y/s,i=b/s;if(e!==t&&(w[e-1]=s),y=n*m[e]+i*w[e],w[e]=n*w[e]-i*m[e],b=i*m[e+1],m[e+1]=n*m[e+1],h)for(let t=0;t<o;t++)s=n*g.get(t,e)+i*g.get(t,e+1),g.set(t,e+1,-i*g.get(t,e)+n*g.get(t,e+1)),g.set(t,e,s);if(s=T(y,b),0===s&&(s=Number.MIN_VALUE),n=y/s,i=b/s,m[e]=s,y=n*w[e]+i*m[e+1],m[e+1]=-i*w[e]+n*m[e+1],b=i*w[e+1],w[e+1]=n*w[e+1],u&&e<r-1)for(let t=0;t<r;t++)s=n*p.get(t,e)+i*p.get(t,e+1),p.set(t,e+1,-i*p.get(t,e)+n*p.get(t,e+1)),p.set(t,e,s)}w[x-2]=y;break}case 4:if(m[t]<=0&&(m[t]=m[t]<0?-m[t]:0,h))for(let e=0;e<=_;e++)g.set(e,t,-g.get(e,t));for(;t<_&&!(m[t]>=m[t+1]);){let e=m[t];if(m[t]=m[t+1],m[t+1]=e,h&&t<o-1)for(let r=0;r<o;r++)e=g.get(r,t+1),g.set(r,t+1,g.get(r,t)),g.set(r,t,e);if(u&&t<r-1)for(let o=0;o<r;o++)e=p.get(o,t+1),p.set(o,t+1,p.get(o,t)),p.set(o,t,e);t++}x--}}if(l){let t=g;g=p,p=t}this.m=r,this.n=o,this.s=m,this.U=p,this.V=g}solve(t){let e=t,r=this.threshold,o=this.s.length,s=S.zeros(o,o);for(let t=0;t<o;t++)Math.abs(this.s[t])<=r?s.set(t,t,0):s.set(t,t,1/this.s[t]);let n=this.U,i=this.rightSingularVectors,a=i.mmul(s),u=i.rows,h=n.rows,l=S.zeros(u,h);for(let t=0;t<u;t++)for(let e=0;e<h;e++){let r=0;for(let s=0;s<o;s++)r+=a.get(t,s)*n.get(e,s);l.set(t,e,r)}return l.mmul(e)}solveForDiagonal(t){return this.solve(S.diag(t))}inverse(){let t=this.V,e=this.threshold,r=t.rows,o=t.columns,s=new S(r,this.s.length);for(let n=0;n<r;n++)for(let r=0;r<o;r++)Math.abs(this.s[r])>e&&s.set(n,r,t.get(n,r)/this.s[r]);let n=this.U,i=n.rows,a=n.columns,u=new S(r,i);for(let t=0;t<r;t++)for(let e=0;e<i;e++){let r=0;for(let o=0;o<a;o++)r+=s.get(t,o)*n.get(e,o);u.set(t,e,r)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,r=this.s;for(let o=0,s=r.length;o<s;o++)r[o]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return S.diag(this.s)}}function P(t,e,r=!1){return t=N.checkMatrix(t),e=N.checkMatrix(e),r?new I(t).solve(e):t.isSquare()?new z(t).solve(e):new W(t).solve(e)}function O(t,e){let r=[];for(let o=0;o<t;o++)o!==e&&r.push(o);return r}function j(t,e,r,o=1e-9,s=1e-9){if(t>s)return new Array(e.rows+1).fill(0);{let t=e.addRow(r,[0]);for(let e=0;e<t.rows;e++)Math.abs(t.get(e,0))<o&&t.set(e,0,0);return t.to1DArray()}}class C{constructor(t,e={}){const{assumeSymmetric:r=!1}=e;if(!(t=N.checkMatrix(t)).isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let o,s,n=t.columns,i=new S(n,n),a=new Float64Array(n),u=new Float64Array(n),h=t,l=!1;if(l=!!r||t.isSymmetric(),l){for(o=0;o<n;o++)for(s=0;s<n;s++)i.set(o,s,h.get(o,s));!function(t,e,r,o){let s,n,i,a,u,h,l,c;for(u=0;u<t;u++)r[u]=o.get(t-1,u);for(a=t-1;a>0;a--){for(c=0,i=0,h=0;h<a;h++)c+=Math.abs(r[h]);if(0===c)for(e[a]=r[a-1],u=0;u<a;u++)r[u]=o.get(a-1,u),o.set(a,u,0),o.set(u,a,0);else{for(h=0;h<a;h++)r[h]/=c,i+=r[h]*r[h];for(s=r[a-1],n=Math.sqrt(i),s>0&&(n=-n),e[a]=c*n,i-=s*n,r[a-1]=s-n,u=0;u<a;u++)e[u]=0;for(u=0;u<a;u++){for(s=r[u],o.set(u,a,s),n=e[u]+o.get(u,u)*s,h=u+1;h<=a-1;h++)n+=o.get(h,u)*r[h],e[h]+=o.get(h,u)*s;e[u]=n}for(s=0,u=0;u<a;u++)e[u]/=i,s+=e[u]*r[u];for(l=s/(i+i),u=0;u<a;u++)e[u]-=l*r[u];for(u=0;u<a;u++){for(s=r[u],n=e[u],h=u;h<=a-1;h++)o.set(h,u,o.get(h,u)-(s*e[h]+n*r[h]));r[u]=o.get(a-1,u),o.set(a,u,0)}}r[a]=i}for(a=0;a<t-1;a++){if(o.set(t-1,a,o.get(a,a)),o.set(a,a,1),i=r[a+1],0!==i){for(h=0;h<=a;h++)r[h]=o.get(h,a+1)/i;for(u=0;u<=a;u++){for(n=0,h=0;h<=a;h++)n+=o.get(h,a+1)*o.get(h,u);for(h=0;h<=a;h++)o.set(h,u,o.get(h,u)-n*r[h])}}for(h=0;h<=a;h++)o.set(h,a+1,0)}for(u=0;u<t;u++)r[u]=o.get(t-1,u),o.set(t-1,u,0);o.set(t-1,t-1,1),e[0]=0}(n,u,a,i),function(t,e,r,o){let s,n,i,a,u,h,l,c,f,m,p,g,w,d,y,b;for(i=1;i<t;i++)e[i-1]=e[i];e[t-1]=0;let v=0,M=0,x=Number.EPSILON;for(h=0;h<t;h++){for(M=Math.max(M,Math.abs(r[h])+Math.abs(e[h])),l=h;l<t&&!(Math.abs(e[l])<=x*M);)l++;if(l>h)do{for(s=r[h],c=(r[h+1]-s)/(2*e[h]),f=T(c,1),c<0&&(f=-f),r[h]=e[h]/(c+f),r[h+1]=e[h]*(c+f),m=r[h+1],n=s-r[h],i=h+2;i<t;i++)r[i]-=n;for(v+=n,c=r[l],p=1,g=p,w=p,d=e[h+1],y=0,b=0,i=l-1;i>=h;i--)for(w=g,g=p,b=y,s=p*e[i],n=p*c,f=T(c,e[i]),e[i+1]=y*f,y=e[i]/f,p=c/f,c=p*r[i]-y*s,r[i+1]=n+y*(p*s+y*r[i]),u=0;u<t;u++)n=o.get(u,i+1),o.set(u,i+1,y*o.get(u,i)+p*n),o.set(u,i,p*o.get(u,i)-y*n);c=-y*b*w*d*e[h]/m,e[h]=y*c,r[h]=p*c}while(Math.abs(e[h])>x*M);r[h]=r[h]+v,e[h]=0}for(i=0;i<t-1;i++){for(u=i,c=r[i],a=i+1;a<t;a++)r[a]<c&&(u=a,c=r[a]);if(u!==i)for(r[u]=r[i],r[i]=c,a=0;a<t;a++)c=o.get(a,i),o.set(a,i,o.get(a,u)),o.set(a,u,c)}}(n,u,a,i)}else{let t=new S(n,n),e=new Float64Array(n);for(s=0;s<n;s++)for(o=0;o<n;o++)t.set(o,s,h.get(o,s));!function(t,e,r,o){let s,n,i,a,u,h,l,c=t-1;for(h=1;h<=c-1;h++){for(l=0,a=h;a<=c;a++)l+=Math.abs(e.get(a,h-1));if(0!==l){for(i=0,a=c;a>=h;a--)r[a]=e.get(a,h-1)/l,i+=r[a]*r[a];for(n=Math.sqrt(i),r[h]>0&&(n=-n),i-=r[h]*n,r[h]=r[h]-n,u=h;u<t;u++){for(s=0,a=c;a>=h;a--)s+=r[a]*e.get(a,u);for(s/=i,a=h;a<=c;a++)e.set(a,u,e.get(a,u)-s*r[a])}for(a=0;a<=c;a++){for(s=0,u=c;u>=h;u--)s+=r[u]*e.get(a,u);for(s/=i,u=h;u<=c;u++)e.set(a,u,e.get(a,u)-s*r[u])}r[h]=l*r[h],e.set(h,h-1,l*n)}}for(a=0;a<t;a++)for(u=0;u<t;u++)o.set(a,u,a===u?1:0);for(h=c-1;h>=1;h--)if(0!==e.get(h,h-1)){for(a=h+1;a<=c;a++)r[a]=e.get(a,h-1);for(u=h;u<=c;u++){for(n=0,a=h;a<=c;a++)n+=r[a]*o.get(a,u);for(n=n/r[h]/e.get(h,h-1),a=h;a<=c;a++)o.set(a,u,o.get(a,u)+n*r[a])}}}(n,t,e,i),function(t,e,r,o,s){let n,i,a,u,h,l,c,f,m,p,g,w,d,y,b,v=t-1,M=t-1,x=Number.EPSILON,S=0,_=0,E=0,A=0,R=0,k=0,N=0,z=0;for(n=0;n<t;n++)for((n<0||n>M)&&(r[n]=s.get(n,n),e[n]=0),i=Math.max(n-1,0);i<t;i++)_+=Math.abs(s.get(n,i));for(;v>=0;){for(u=v;u>0&&(k=Math.abs(s.get(u-1,u-1))+Math.abs(s.get(u,u)),0===k&&(k=_),!(Math.abs(s.get(u,u-1))<x*k));)u--;if(u===v)s.set(v,v,s.get(v,v)+S),r[v]=s.get(v,v),e[v]=0,v--,z=0;else if(u===v-1){if(c=s.get(v,v-1)*s.get(v-1,v),E=(s.get(v-1,v-1)-s.get(v,v))/2,A=E*E+c,N=Math.sqrt(Math.abs(A)),s.set(v,v,s.get(v,v)+S),s.set(v-1,v-1,s.get(v-1,v-1)+S),f=s.get(v,v),A>=0){for(N=E>=0?E+N:E-N,r[v-1]=f+N,r[v]=r[v-1],0!==N&&(r[v]=f-c/N),e[v-1]=0,e[v]=0,f=s.get(v,v-1),k=Math.abs(f)+Math.abs(N),E=f/k,A=N/k,R=Math.sqrt(E*E+A*A),E/=R,A/=R,i=v-1;i<t;i++)N=s.get(v-1,i),s.set(v-1,i,A*N+E*s.get(v,i)),s.set(v,i,A*s.get(v,i)-E*N);for(n=0;n<=v;n++)N=s.get(n,v-1),s.set(n,v-1,A*N+E*s.get(n,v)),s.set(n,v,A*s.get(n,v)-E*N);for(n=0;n<=M;n++)N=o.get(n,v-1),o.set(n,v-1,A*N+E*o.get(n,v)),o.set(n,v,A*o.get(n,v)-E*N)}else r[v-1]=f+E,r[v]=f+E,e[v-1]=N,e[v]=-N;v-=2,z=0}else{if(f=s.get(v,v),m=0,c=0,u<v&&(m=s.get(v-1,v-1),c=s.get(v,v-1)*s.get(v-1,v)),10===z){for(S+=f,n=0;n<=v;n++)s.set(n,n,s.get(n,n)-f);k=Math.abs(s.get(v,v-1))+Math.abs(s.get(v-1,v-2)),f=m=.75*k,c=-.4375*k*k}if(30===z&&(k=(m-f)/2,k=k*k+c,k>0)){for(k=Math.sqrt(k),m<f&&(k=-k),k=f-c/((m-f)/2+k),n=0;n<=v;n++)s.set(n,n,s.get(n,n)-k);S+=k,f=m=c=.964}for(z+=1,h=v-2;h>=u&&(N=s.get(h,h),R=f-N,k=m-N,E=(R*k-c)/s.get(h+1,h)+s.get(h,h+1),A=s.get(h+1,h+1)-N-R-k,R=s.get(h+2,h+1),k=Math.abs(E)+Math.abs(A)+Math.abs(R),E/=k,A/=k,R/=k,h!==u)&&!(Math.abs(s.get(h,h-1))*(Math.abs(A)+Math.abs(R))<x*(Math.abs(E)*(Math.abs(s.get(h-1,h-1))+Math.abs(N)+Math.abs(s.get(h+1,h+1)))));)h--;for(n=h+2;n<=v;n++)s.set(n,n-2,0),n>h+2&&s.set(n,n-3,0);for(a=h;a<=v-1&&(y=a!==v-1,a!==h&&(E=s.get(a,a-1),A=s.get(a+1,a-1),R=y?s.get(a+2,a-1):0,f=Math.abs(E)+Math.abs(A)+Math.abs(R),0!==f&&(E/=f,A/=f,R/=f)),0!==f);a++)if(k=Math.sqrt(E*E+A*A+R*R),E<0&&(k=-k),0!==k){for(a!==h?s.set(a,a-1,-k*f):u!==h&&s.set(a,a-1,-s.get(a,a-1)),E+=k,f=E/k,m=A/k,N=R/k,A/=E,R/=E,i=a;i<t;i++)E=s.get(a,i)+A*s.get(a+1,i),y&&(E+=R*s.get(a+2,i),s.set(a+2,i,s.get(a+2,i)-E*N)),s.set(a,i,s.get(a,i)-E*f),s.set(a+1,i,s.get(a+1,i)-E*m);for(n=0;n<=Math.min(v,a+3);n++)E=f*s.get(n,a)+m*s.get(n,a+1),y&&(E+=N*s.get(n,a+2),s.set(n,a+2,s.get(n,a+2)-E*R)),s.set(n,a,s.get(n,a)-E),s.set(n,a+1,s.get(n,a+1)-E*A);for(n=0;n<=M;n++)E=f*o.get(n,a)+m*o.get(n,a+1),y&&(E+=N*o.get(n,a+2),o.set(n,a+2,o.get(n,a+2)-E*R)),o.set(n,a,o.get(n,a)-E),o.set(n,a+1,o.get(n,a+1)-E*A)}}}if(0!==_){for(v=t-1;v>=0;v--)if(E=r[v],A=e[v],0===A)for(u=v,s.set(v,v,1),n=v-1;n>=0;n--){for(c=s.get(n,n)-E,R=0,i=u;i<=v;i++)R+=s.get(n,i)*s.get(i,v);if(e[n]<0)N=c,k=R;else if(u=n,0===e[n]?s.set(n,v,0!==c?-R/c:-R/(x*_)):(f=s.get(n,n+1),m=s.get(n+1,n),A=(r[n]-E)*(r[n]-E)+e[n]*e[n],l=(f*k-N*R)/A,s.set(n,v,l),s.set(n+1,v,Math.abs(f)>Math.abs(N)?(-R-c*l)/f:(-k-m*l)/N)),l=Math.abs(s.get(n,v)),x*l*l>1)for(i=n;i<=v;i++)s.set(i,v,s.get(i,v)/l)}else if(A<0)for(u=v-1,Math.abs(s.get(v,v-1))>Math.abs(s.get(v-1,v))?(s.set(v-1,v-1,A/s.get(v,v-1)),s.set(v-1,v,-(s.get(v,v)-E)/s.get(v,v-1))):(b=q(0,-s.get(v-1,v),s.get(v-1,v-1)-E,A),s.set(v-1,v-1,b[0]),s.set(v-1,v,b[1])),s.set(v,v-1,0),s.set(v,v,1),n=v-2;n>=0;n--){for(p=0,g=0,i=u;i<=v;i++)p+=s.get(n,i)*s.get(i,v-1),g+=s.get(n,i)*s.get(i,v);if(c=s.get(n,n)-E,e[n]<0)N=c,R=p,k=g;else if(u=n,0===e[n]?(b=q(-p,-g,c,A),s.set(n,v-1,b[0]),s.set(n,v,b[1])):(f=s.get(n,n+1),m=s.get(n+1,n),w=(r[n]-E)*(r[n]-E)+e[n]*e[n]-A*A,d=2*(r[n]-E)*A,0===w&&0===d&&(w=x*_*(Math.abs(c)+Math.abs(A)+Math.abs(f)+Math.abs(m)+Math.abs(N))),b=q(f*R-N*p+A*g,f*k-N*g-A*p,w,d),s.set(n,v-1,b[0]),s.set(n,v,b[1]),Math.abs(f)>Math.abs(N)+Math.abs(A)?(s.set(n+1,v-1,(-p-c*s.get(n,v-1)+A*s.get(n,v))/f),s.set(n+1,v,(-g-c*s.get(n,v)-A*s.get(n,v-1))/f)):(b=q(-R-m*s.get(n,v-1),-k-m*s.get(n,v),N,A),s.set(n+1,v-1,b[0]),s.set(n+1,v,b[1]))),l=Math.max(Math.abs(s.get(n,v-1)),Math.abs(s.get(n,v))),x*l*l>1)for(i=n;i<=v;i++)s.set(i,v-1,s.get(i,v-1)/l),s.set(i,v,s.get(i,v)/l)}for(n=0;n<t;n++)if(n<0||n>M)for(i=n;i<t;i++)o.set(n,i,s.get(n,i));for(i=t-1;i>=0;i--)for(n=0;n<=M;n++){for(N=0,a=0;a<=Math.min(i,M);a++)N+=o.get(n,a)*s.get(a,i);o.set(n,i,N)}}}(n,u,a,i,t)}this.n=n,this.e=u,this.d=a,this.V=i}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t,e,r=this.n,o=this.e,s=this.d,n=new S(r,r);for(t=0;t<r;t++){for(e=0;e<r;e++)n.set(t,e,0);n.set(t,t,s[t]),o[t]>0?n.set(t,t+1,o[t]):o[t]<0&&n.set(t,t-1,o[t])}return n}}function q(t,e,r,o){let s,n;return Math.abs(r)>Math.abs(o)?(s=o/r,n=r+s*o,[(t+s*e)/n,(e-s*t)/n]):(s=r/o,n=o+s*r,[(s*t+e)/n,(s*e-t)/n])}class F{constructor(t){if(!(t=N.checkMatrix(t)).isSymmetric())throw new Error("Matrix is not symmetric");let e,r,o,s=t,n=s.rows,i=new S(n,n),a=!0;for(r=0;r<n;r++){let t=0;for(o=0;o<r;o++){let n=0;for(e=0;e<o;e++)n+=i.get(o,e)*i.get(r,e);n=(s.get(r,o)-n)/i.get(o,o),i.set(r,o,n),t+=n*n}for(t=s.get(r,r)-t,a&&=t>0,i.set(r,r,Math.sqrt(Math.max(t,0))),o=r+1;o<n;o++)i.set(r,o,0)}this.L=i,this.positiveDefinite=a}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=N.checkMatrix(t);let e=this.L,r=e.rows;if(t.rows!==r)throw new Error("Matrix dimensions do not match");if(!1===this.isPositiveDefinite())throw new Error("Matrix is not positive definite");let o,s,n,i=t.columns,a=t.clone();for(n=0;n<r;n++)for(s=0;s<i;s++){for(o=0;o<n;o++)a.set(n,s,a.get(n,s)-a.get(o,s)*e.get(n,o));a.set(n,s,a.get(n,s)/e.get(n,n))}for(n=r-1;n>=0;n--)for(s=0;s<i;s++){for(o=n+1;o<r;o++)a.set(n,s,a.get(n,s)-a.get(o,s)*e.get(o,n));a.set(n,s,a.get(n,s)/e.get(n,n))}return a}get lowerTriangularMatrix(){return this.L}}class D{constructor(t,e={}){t=N.checkMatrix(t);let{Y:r}=e;const{scaleScores:s=!1,maxIterations:n=1e3,terminationCriteria:i=1e-10}=e;let a;if(r){if(r=o.isAnyArray(r)&&"number"==typeof r[0]?S.columnVector(r):N.checkMatrix(r),r.rows!==t.rows)throw new Error("Y should have the same number of rows as X");a=r.getColumnVector(0)}else a=t.getColumnVector(0);let u,h,l,c,f=1;for(let e=0;e<n&&f>i;e++)l=t.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),l=l.div(l.norm()),u=t.mmul(l).div(l.transpose().mmul(l).get(0,0)),e>0&&(f=u.clone().sub(c).pow(2).sum()),c=u.clone(),r?(h=r.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),h=h.div(h.norm()),a=r.mmul(h).div(h.transpose().mmul(h).get(0,0))):a=u;if(r){let e=t.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0));e=e.div(e.norm());let o=t.clone().sub(u.clone().mmul(e.transpose())),s=a.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),n=r.clone().sub(u.clone().mulS(s.get(0,0)).mmul(h.transpose()));this.t=u,this.p=e.transpose(),this.w=l.transpose(),this.q=h,this.u=a,this.s=u.transpose().mmul(u),this.xResidual=o,this.yResidual=n,this.betas=s}else this.w=l.transpose(),this.s=u.transpose().mmul(u).sqrt(),this.t=s?u.clone().div(this.s.get(0,0)):u,this.xResidual=t.sub(u.mmul(l.transpose()))}}e.y3=v,e.jy=F,e.oN=F,e.Hc=E,e.cg=C,e.hj=C,e.LU=z,e.Tb=z,e.uq=S,e.Zm=class extends A{constructor(t,e){g(t,e),super(t,t.rows,e.length),this.columnIndices=e}set(t,e,r){return this.matrix.set(t,this.columnIndices[e],r),this}get(t,e){return this.matrix.get(t,this.columnIndices[e])}},e.Dq=class extends A{constructor(t,e){c(t,e),super(t,t.rows,1),this.column=e}set(t,e,r){return this.matrix.set(t,this.column,r),this}get(t){return this.matrix.get(t,this.column)}},e.__=class extends A{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(t,this.columns-e-1,r),this}get(t,e){return this.matrix.get(t,this.columns-e-1)}},e.q0=class extends A{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(this.rows-t-1,e,r),this}get(t,e){return this.matrix.get(this.rows-t-1,e)}},e.lh=class extends A{constructor(t,e){p(t,e),super(t,e.length,t.columns),this.rowIndices=e}set(t,e,r){return this.matrix.set(this.rowIndices[t],e,r),this}get(t,e){return this.matrix.get(this.rowIndices[t],e)}},e.pI=class extends A{constructor(t,e){l(t,e),super(t,1,t.columns),this.row=e}set(t,e,r){return this.matrix.set(this.row,e,r),this}get(t,e){return this.matrix.get(this.row,e)}},e.zC=R,e.zg=class extends A{constructor(t,e,r,o,s){w(t,e,r,o,s),super(t,r-e+1,s-o+1),this.startRow=e,this.startColumn=o}set(t,e,r){return this.matrix.set(this.startRow+t,this.startColumn+e,r),this}get(t,e){return this.matrix.get(this.startRow+t,this.startColumn+e)}},e.g6=class extends A{constructor(t){super(t,t.columns,t.rows)}set(t,e,r){return this.matrix.set(e,t,r),this}get(t,e){return this.matrix.get(e,t)}},e.OL=D,e.ks=D,e.QR=W,e.jp=W,e.mk=I,e.W2=I,e.l=_,e.KY=k,e.dv=N,e.BR=function(t,e=t,r={}){t=new S(t);let s=!1;if("object"!=typeof e||S.isMatrix(e)||o.isAnyArray(e)?e=new S(e):(r=e,e=t,s=!0),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:n=!0,scale:i=!0}=r;n&&(t.center("column"),s||e.center("column")),i&&(t.scale("column"),s||e.scale("column"));const a=t.standardDeviation("column",{unbiased:!0}),u=s?a:e.standardDeviation("column",{unbiased:!0}),h=t.transpose().mmul(e);for(let e=0;e<h.rows;e++)for(let r=0;r<h.columns;r++)h.set(e,r,h.get(e,r)*(1/(a[e]*u[r]))*(1/(t.rows-1)));return h},e.Wu=function(t,e=t,r={}){t=new S(t);let s=!1;if("object"!=typeof e||S.isMatrix(e)||o.isAnyArray(e)?e=new S(e):(r=e,e=t,s=!0),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:n=!0}=r;n&&(t=t.center("column"),s||(e=e.center("column")));const i=t.transpose().mmul(e);for(let e=0;e<i.rows;e++)for(let r=0;r<i.columns;r++)i.set(e,r,i.get(e,r)*(1/(t.rows-1)));return i},e.a4=function t(e){if((e=S.checkMatrix(e)).isSquare()){if(0===e.columns)return 1;let r,o,s,n;if(2===e.columns)return r=e.get(0,0),o=e.get(0,1),s=e.get(1,0),n=e.get(1,1),r*n-o*s;if(3===e.columns){let n,i,a;return n=new R(e,[1,2],[1,2]),i=new R(e,[1,2],[0,2]),a=new R(e,[1,2],[0,1]),r=e.get(0,0),o=e.get(0,1),s=e.get(0,2),r*t(n)-o*t(i)+s*t(a)}return new z(e).determinant}throw Error("determinant can only be calculated for a square matrix")},e.DI=function(t,e=!1){return t=N.checkMatrix(t),e?new I(t).inverse():P(t,S.eye(t.rows))},e.Jo=function(t,e={}){const{thresholdValue:r=1e-9,thresholdError:o=1e-9}=e;let s=(t=S.checkMatrix(t)).rows,n=new S(s,s);for(let e=0;e<s;e++){let i=S.columnVector(t.getRow(e)),a=t.subMatrixRow(O(s,e)).transpose(),u=new I(a).solve(i),h=S.sub(i,a.mmul(u)).abs().max();n.setRow(e,j(h,u,e,r,o))}return n},e.Zi=function(t,e=Number.EPSILON){if((t=S.checkMatrix(t)).isEmpty())return t.transpose();let r=new I(t,{autoTranspose:!0}),o=r.leftSingularVectors,s=r.rightSingularVectors,n=r.diagonal;for(let t=0;t<n.length;t++)Math.abs(n[t])>e?n[t]=1/n[t]:n[t]=0;return s.mmul(S.diag(n).mmul(o.transpose()))},e.kH=P,e.LV=function(t,e){if(o.isAnyArray(t))return t[0]&&o.isAnyArray(t[0])?new N(t):new k(t,e);throw new Error("the argument is not an array")}},718(t,e,r){r.r(e),r.d(e,{default:()=>s});var o=r(788);function s(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,o.isAnyArray)(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==r.output){if(!(0,o.isAnyArray)(r.output))throw new TypeError("output option must be an array if specified");e=r.output}else e=new Array(t.length);var s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,o.isAnyArray)(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var r=e.fromIndex,s=void 0===r?0:r,n=e.toIndex,i=void 0===n?t.length:n;if(s<0||s>=t.length||!Number.isInteger(s))throw new Error("fromIndex must be a positive integer smaller than length");if(i<=s||i>t.length||!Number.isInteger(i))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[s],u=s+1;u<i;u++)t[u]<a&&(a=t[u]);return a}(t),n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,o.isAnyArray)(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");var r=e.fromIndex,s=void 0===r?0:r,n=e.toIndex,i=void 0===n?t.length:n;if(s<0||s>=t.length||!Number.isInteger(s))throw new Error("fromIndex must be a positive integer smaller than length");if(i<=s||i>t.length||!Number.isInteger(i))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[s],u=s+1;u<i;u++)t[u]>a&&(a=t[u]);return a}(t);if(s===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var i=r.min,a=void 0===i?r.autoMinMax?s:0:i,u=r.max,h=void 0===u?r.autoMinMax?n:1:u;if(a>=h)throw new RangeError("min option must be smaller than max option");for(var l=(h-a)/(n-s),c=0;c<t.length;c++)e[c]=(t[c]-s)*l+a;return e}},788(t,e,r){r.r(e),r.d(e,{isAnyArray:()=>s});const o=Object.prototype.toString;function s(t){const e=o.call(t);return e.endsWith("Array]")&&!e.includes("Big")}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var r=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(r.exports,r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(t,e)=>{for(var r in e)__webpack_require__.o(e,r)&&!__webpack_require__.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{var t=__webpack_exports__;Object.defineProperty(t,"__esModule",{value:!0}),t.UMAP=void 0;var e=__webpack_require__(329);Object.defineProperty(t,"UMAP",{enumerable:!0,get:function(){return e.UMAP}})})(),__webpack_exports__})());